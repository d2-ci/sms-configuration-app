(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[132],{190:function(e,a,t){e.exports={container:"App_container__2zgzu",sidebar:"App_sidebar__10tAV",content:"App_content__3I8HS"}},191:function(e,a,t){e.exports={headline:"PageHeadline_headline__1llN5"}},192:function(e){e.exports=JSON.parse('{"Are you sure you want to cancel? Unsaved changes will be lost":"","Yes, cancel":"","No, stay on page":"","Dataset":"","Confirm deletion":"","Are you sure you want to delete the selected gateways?":"","Auth token":"","Name":"","Password":"","Url template":"","User name":"","Add key value pair":"","Save gateway":"","Add gateway":"","Cancel":"","Submitting...":"","With a generic http gateway any number of parameters can be added with key value pairs":"","Key":"","Value":"","Send as header":"","Encode":"","Confidential":"","Remove key value pair":"","Type":"","Make default":"","Default gateway":"","Edit":"","BulkSMS":"","Clickatell":"","Generic":"","Program":"","Program stage":"","Delete confirmation":"","Delete command configurations":"","Save command":"","Something went wrong whilst submitting the form":"","Something went wrong whilst loading the sms command":"","Something went wrong whilst loading the command\'s details":"","SMS short codes":"","Add special character":"","Data element category combination validation error":"","Completeness method":"","Confirm message":"","Reply message if no codes are sent (only the command)":"","More than one orgunit message":"","No user message":"","Parser":"","Field separator":"","Special character name":"","Special character value":"","Remove":"","Success message":"","Use current period for reporting":"","Wrong format message":"","default":"","Edit formula":"","Add formula":"","Formula for {{combo}}":"","Data element":"","formula operator":"","Save":"","Receive all data value":"","Receive at least one data value":"","Do not mark as complete":"","Key value parser":"","J2ME parser":"","Alert parser":"","Unregistered parser":"","Tracked entity registration parser":"","Program stage data entry parser":"","Event registration parser":"","Duplicate value!":"","Usergroup":"","Something went wrong whilst loading gateways":"","Edit gateway":"","Something went wrong whilst saving gateways":"","Something went wrong whilst performing the requested operation":"","There are five different types of gateways supported by the SMS service. SMSes can be sent if at least one of the gateway types has been configured. If more than one gateway has been configured they will all be used in a round-robin fashion for load balancing":"","Delete selected":"","Filter by status":"","Filter by phone number":"","Filter":"","Show":"","per page":"","Viewing {{firstItem}}-{{lastItem}} of {{total}}":"","Previous":"","Page":"","of {{pageCount}}":"","Next":"","Message":"","Phone number":"","Status":"","Sender":"","Date":"","No SMSes to display":"","Unknown":"","Could not load list of received SMSes":"","Received":"","All":"","Failed":"","Incoming":"","Processed":"","Processing":"","Sent":"","Unhandled":"","Something went wrong whilst loading sent SMSes":"","Recipients":"","Delivered":"","Error":"","Outbound":"","Pending":"","Scheduled":"","Something went wrong whilst loading commands":"","Edit command":"","Add command":"","Commands":"","Sms command":""}')},193:function(e,a,t){e.exports={formRow:"FormRow_formRow__3ALDU"}},194:function(e,a,t){e.exports={textInputs:"GatewayKeyValuePair_textInputs__dJAb3",keyInput:"GatewayKeyValuePair_keyInput__2WHV_",valueInput:"GatewayKeyValuePair_valueInput__1uRVv",checkboxGroup:"GatewayKeyValuePair_checkboxGroup__2k2Cu",checkbox:"GatewayKeyValuePair_checkbox__2hg0g"}},195:function(e,a,t){e.exports={container:"GatewayConfigFormEdit_container__1d38w"}},201:function(e,a,t){e.exports={rowActions:"GatewaysTable_rowActions__2fK3j",checkboxCell:"GatewaysTable_checkboxCell__3uvd3",typeCell:"GatewaysTable_typeCell__Qx_fl",editCell:"GatewaysTable_editCell__3mzrM",defaultCell:"GatewaysTable_defaultCell__1huny",makeDefaultButton:"GatewaysTable_makeDefaultButton__3gFiv",isDefaultText:"GatewaysTable_isDefaultText__15qyD"}},202:function(e,a,t){e.exports={container:"GatewayList_container__jCYee",processingMessage:"GatewayList_processingMessage__1RE2H",loadingContainer:"GatewayList_loadingContainer__7veW4"}},203:function(e,a,t){e.exports={container:"GatewayConfigFormNew_container__pJ1_K"}},204:function(e,a,t){e.exports={container:"ListActions_container__2mPW8"}},205:function(e,a,t){e.exports={container:"GatewayConfigList_container__3BZQo",actions:"GatewayConfigList_actions__yMRge"}},206:function(e,a,t){e.exports={container:"Filter_container__zWNRg",inputStrip:"Filter_inputStrip__28I4q"}},207:function(e,a,t){e.exports={container:"Pagination_container__1oOhc",verticalAlign:"Pagination_verticalAlign__2xbtG",select:"Pagination_select__39auA",buttonPrevious:"Pagination_buttonPrevious__SXF81",buttonNext:"Pagination_buttonNext__1HLDE",summary:"Pagination_summary__2dp6R"}},208:function(e,a,t){e.exports={noResults:"SmsTable_noResults__1t04p",originator:"SmsTable_originator__22EFE"}},209:function(e,a,t){e.exports={container:"ReceivedSmsList_container__vRAw_",topBar:"ReceivedSmsList_topBar__2qRs6"}},210:function(e,a,t){e.exports={container:"FieldDataElementWithCategoryOptionCombo_container__2h1m8",field:"FieldDataElementWithCategoryOptionCombo_field__mnPuJ"}},211:function(e,a,t){e.exports={formRow:"DataElementTimesCategoryOptionCombos_formRow__TGwSL"}},212:function(e,a,t){e.exports={container:"FieldCommandSpecialCharacter_container__2Vgvs",field:"FieldCommandSpecialCharacter_field__-1mZE",button:"FieldCommandSpecialCharacter_button__2XK2-"}},213:function(e,a,t){e.exports={container:"SmsCommandFormEdit_container__2r8xI"}},214:function(e,a,t){e.exports={container:"SmsCommandFormNew_container__34D_E"}},215:function(e,a,t){e.exports={container:"SmsCommandList_container__2tb7Z",editButtonCell:"SmsCommandList_editButtonCell__1OBCC",checkbox:"SmsCommandList_checkbox__1mJm5"}},216:function(e,a,t){e.exports={recipient:"SmsTableItem_recipient__2d7vB"}},217:function(e,a,t){e.exports={container:"Pagination_container__2LAE2",left:"Pagination_left__1ff2z",right:"Pagination_right__2Py4F",amount:"Pagination_amount__19_-8",pageselection:"Pagination_pageselection__27-Pj"}},218:function(e,a,t){e.exports={noResults:"SmsTable_noResults__rTkg-"}},219:function(e,a,t){e.exports={container:"SentSmsList_container__2FUki",header:"SentSmsList_header__3biA5",headerRight:"SentSmsList_headerRight__XinlM"}},223:function(e,a,t){"use strict";t.r(a);var n={};t.r(n),t.d(n,"ALL_DATAVALUE",(function(){return Pa})),t.d(n,"AT_LEAST_ONE_DATAVALUE",(function(){return xa})),t.d(n,"DO_NOT_MARK_COMPLETE",(function(){return Ga}));var l={};t.r(l),t.d(l,"KEY_VALUE_PARSER",(function(){return Lt})),t.d(l,"J2ME_PARSER",(function(){return qt})),t.d(l,"ALERT_PARSER",(function(){return Ut})),t.d(l,"UNREGISTERED_PARSER",(function(){return Vt})),t.d(l,"TRACKED_ENTITY_REGISTRATION_PARSER",(function(){return Bt})),t.d(l,"PROGRAM_STAGE_DATAENTRY_PARSER",(function(){return zt})),t.d(l,"EVENT_REGISTRATION_PARSER",(function(){return Jt}));var r={};t.r(r),t.d(r,"CommandsAddSpecialCharacters",(function(){return Ia})),t.d(r,"ALL_DATAVALUE",(function(){return Pa})),t.d(r,"AT_LEAST_ONE_DATAVALUE",(function(){return xa})),t.d(r,"DO_NOT_MARK_COMPLETE",(function(){return Ga})),t.d(r,"DataElementTimesCategoryOptionCombos",(function(){return Ot})),t.d(r,"FieldCommandCompletenessMethod",(function(){return Tt})),t.d(r,"FieldCommandConfirmMessage",(function(){return Rt})),t.d(r,"FieldCommandDefaultMessage",(function(){return jt})),t.d(r,"FieldCommandMoreThanOneOrgUnitMessage",(function(){return Ft})),t.d(r,"FieldCommandName",(function(){return Pt})),t.d(r,"FieldCommandNoUserMessage",(function(){return Gt})),t.d(r,"FieldCommandParser",(function(){return Ht})),t.d(r,"FieldCommandSeparator",(function(){return Xt})),t.d(r,"FieldCommandSmsCode",(function(){return en})),t.d(r,"FieldCommandSpecialCharacter",(function(){return rn})),t.d(r,"FieldCommandSuccessMessage",(function(){return cn})),t.d(r,"FieldCommandUseCurrentPeriodForReporting",(function(){return mn})),t.d(r,"FieldCommandWrongFormatMessage",(function(){return un})),t.d(r,"FieldDataElementWithCategoryOptionCombo",(function(){return St})),t.d(r,"FieldDataElementWithCategoryOptionComboFormula",(function(){return pt})),t.d(r,"FIELD_COMMAND_COMPLETENESS_METHOD_NAME",(function(){return ya})),t.d(r,"FIELD_COMMAND_DEFAULT_MESSAGE_NAME",(function(){return ha})),t.d(r,"FIELD_COMMAND_ID_NAME",(function(){return va})),t.d(r,"FIELD_COMMAND_MORE_THAN_ONE_ORG_UNIT_MESSAGE_NAME",(function(){return Sa})),t.d(r,"FIELD_COMMAND_NAME_NAME",(function(){return Ca})),t.d(r,"FIELD_COMMAND_NO_USER_MESSAGE_NAME",(function(){return wa})),t.d(r,"FIELD_COMMAND_PARSER_NAME",(function(){return _a})),t.d(r,"FIELD_COMMAND_PROGAM_NAME",(function(){return Oa})),t.d(r,"FIELD_COMMAND_PROGAM_STAGE_NAME",(function(){return Aa})),t.d(r,"FIELD_COMMAND_SEPARATOR_NAME",(function(){return Na})),t.d(r,"FIELD_COMMAND_SMS_CODES_NAME",(function(){return Ta})),t.d(r,"FIELD_COMMAND_SPECIAL_CHARS_NAME",(function(){return ka})),t.d(r,"FIELD_COMMAND_SUCCESS_MESSAGE_NAME",(function(){return Ra})),t.d(r,"FIELD_COMMAND_USE_CURRENT_PERIOD_FOR_REPORTING_NAME",(function(){return Ma})),t.d(r,"FIELD_COMMAND_WRONG_FORMAT_MESSAGE_NAME",(function(){return ja})),t.d(r,"FIELD_COMMAND_CONFIRM_MESSAGE_NAME",(function(){return Da})),t.d(r,"KEY_VALUE_PARSER",(function(){return Lt})),t.d(r,"J2ME_PARSER",(function(){return qt})),t.d(r,"ALERT_PARSER",(function(){return Ut})),t.d(r,"UNREGISTERED_PARSER",(function(){return Vt})),t.d(r,"TRACKED_ENTITY_REGISTRATION_PARSER",(function(){return Bt})),t.d(r,"PROGRAM_STAGE_DATAENTRY_PARSER",(function(){return zt})),t.d(r,"EVENT_REGISTRATION_PARSER",(function(){return Jt})),t.d(r,"ProgramStageDataElements",(function(){return gn}));var s=t(175),c=t(174),o=t(173),m=t(1),i=t.n(m),d=t(190),u=t.n(d);const E=Object(m.createContext)({addAlert:()=>{throw new Error("AlertContext has not been initialized yet!")}}),g=(e,a="dhis2-smsconfiguration")=>"".concat(a,"-").concat(e),p=({children:e})=>{const[a,t]=Object(m.useState)([]);return i.a.createElement(E.Provider,{value:{addAlert:e=>t([...a,e])}},e,i.a.createElement(o.b,{dataTest:g("notifications-alerthandler")},a.map(({message:e,type:a})=>i.a.createElement(o.a,Object.assign({dataTest:g("notifications-alert"),key:e},{[a]:!0}),e))))},b=e=>{const{addAlert:a}=Object(m.useContext)(E);Object(m.useEffect)(()=>{e&&a({type:"critical",message:e.message})},[e])};var f=t(191),y=t.n(f);const h=({children:e})=>i.a.createElement("h1",{className:y.a.headline,"data-test":g("headline-pageheadline")},e),v=()=>i.a.createElement("div",{"data-test":g("views-home")},i.a.createElement(h,null,"Home"),i.a.createElement("span",null,"Content?")),S=()=>i.a.createElement("div",{"data-test":g("views-nomatch")},i.a.createElement("h1",null,"404"));var C=t(7),w=t.n(C),_=t(192);w.a.addResources("en","default",_);var O=w.a;const A=({onCancelClick:e,onDeleteClick:a})=>i.a.createElement(o.p,{dataTest:g("gateways-deleteconfirmationdialog")},i.a.createElement(o.s,null,O.t("Confirm deletion")),i.a.createElement(o.r,null,O.t("Are you sure you want to delete the selected gateways?")),i.a.createElement(o.q,null,i.a.createElement(o.d,null,i.a.createElement(o.c,{secondary:!0,onClick:e,dataTest:g("gateways-deleteconfirmationdialog-cancel")},"Cancel"),i.a.createElement(o.c,{destructive:!0,onClick:a,dataTest:g("gateways-deleteconfirmationdialog-confirm")},"Delete")))),{Field:N}=o.u,T=()=>i.a.createElement(N,{required:!0,dataTest:g("gateways-fieldgatewayauthtoken"),name:"authtoken",label:O.t("Auth token"),component:o.m,validate:Object(o.I)(o.K,o.J)}),{Field:k}=o.u,R=()=>i.a.createElement(k,{required:!0,dataTest:g("gateways-fieldgatewayname"),name:"name",label:O.t("Name"),component:o.m,validate:Object(o.I)(o.K,o.J)}),{Field:M}=o.u,j=()=>i.a.createElement(M,{required:!0,dataTest:g("gateways-fieldgatewaypassword"),name:"password",label:O.t("Password"),component:o.m,validate:Object(o.I)(o.K,o.J)}),{Field:D}=o.u,F=()=>i.a.createElement(D,{required:!0,dataTest:g("gateways-fieldgatewayurltemplate"),name:"urlTemplate",label:O.t("Url template"),component:o.m,validate:Object(o.I)(o.L,o.J)}),{Field:I}=o.u,P=()=>i.a.createElement(I,{required:!0,dataTest:g("gateways-fieldgatewayusername"),name:"username",label:O.t("User name"),component:o.m,validate:Object(o.I)(o.K,o.J)}),{useForm:x}=o.u,G=()=>{const{change:e,getState:a}=x();return i.a.createElement(o.c,{onClick:()=>{const{parameters:t}=a().values;e("parameters",[...t,{header:!1,encode:!1,key:"",value:"",confidential:!1}])},dataTest:g("gateways-gatewayaddkeyvaluepair")},O.t("Add key value pair"))};var L=t(6),q=t.n(L),U=t(193),V=t.n(U);const B=({children:e,className:a})=>i.a.createElement("div",{className:q()(V.a.formRow,a),"data-test":g("forms-formrow")},e),{Form:z}=o.u,J=({onCancelClick:e,onSubmit:a,initialValues:t})=>{const n=t?O.t("Save gateway"):O.t("Add gateway");return i.a.createElement(z,{keepDirtyOnReinitialize:!0,onSubmit:a,initialValues:t},({handleSubmit:a,submitting:t,pristine:l})=>i.a.createElement("form",{onSubmit:a,"data-test":g("gateways-gatewaybulksmsform")},i.a.createElement(B,null,i.a.createElement(R,null)),i.a.createElement(B,null,i.a.createElement(P,null)),i.a.createElement(B,null,i.a.createElement(j,null)),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>e(l)},O.t("Cancel")),i.a.createElement(o.c,{primary:!0,type:"submit",dataTest:g("forms-gatewaybulksmsform-submit")},t?O.t("Submitting..."):n))))};J.defaultProps={initialValues:{}};const{Form:K}=o.u,W=({onCancelClick:e,onSubmit:a,initialValues:t})=>{const n=t?O.t("Save gateway"):O.t("Add gateway");return i.a.createElement(K,{keepDirtyOnReinitialize:!0,onSubmit:a,initialValues:t},({handleSubmit:a,submitting:t,pristine:l})=>i.a.createElement("form",{onSubmit:a,"data-test":g("gateways-gatewayclickatellform")},i.a.createElement(B,null,i.a.createElement(R,null)),i.a.createElement(B,null,i.a.createElement(P,null)),i.a.createElement(B,null,i.a.createElement(T,null)),i.a.createElement(B,null,i.a.createElement(F,null)),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>e(l)},O.t("Cancel")),i.a.createElement(o.c,{primary:!0,type:"submit",dataTest:g("forms-gatewayclickatellform-submit")},t?O.t("Submitting..."):n))))};W.defaultProps={initialValues:{}};const{Form:H}=o.u,Y=({onCancelClick:e,onSubmit:a,initialValues:t})=>{const n=t?O.t("Save gateway"):O.t("Add gateway");return i.a.createElement(H,{keepDirtyOnReinitialize:!0,onSubmit:a,initialValues:t},({handleSubmit:a,values:t,submitting:l,pristine:r})=>i.a.createElement("form",{onSubmit:a,"data-test":g("gateways-gatewaygenericform")},i.a.createElement(B,null,i.a.createElement(R,null)),i.a.createElement(B,null,i.a.createElement(F,null)),t.parameters.map((e,a)=>i.a.createElement(ae,{index:a,key:a})),i.a.createElement(B,null,i.a.createElement(o.t,null,O.t("With a generic http gateway any number of parameters can be added with key value pairs"))),i.a.createElement(B,null,i.a.createElement(G,null)),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>e(r)},O.t("Cancel")),i.a.createElement(o.c,{primary:!0,type:"submit",dataTest:g("forms-gatewaygenericform-submit")},l?O.t("Submitting..."):n))))};Y.defaultProps={initialValues:{parameters:[]}};var X=t(194),Z=t.n(X);const{Field:Q,useForm:$}=o.u,ee=Object(o.I)(o.K,o.J),ae=({index:e})=>{const{change:a,getState:t}=$();return i.a.createElement("div",{"data-test":g("gateways-gatewaykeyvaluepair")},i.a.createElement(B,null,i.a.createElement("div",{className:Z.a.textInputs},i.a.createElement(Q,{dataTest:g("gateways-gatewaykeyvaluepair-key"),className:Z.a.keyInput,name:"parameters[".concat(e,"].key"),label:O.t("Key"),component:o.m,validate:ee}),i.a.createElement(Q,{dataTest:g("gateways-gatewaykeyvaluepair-value"),className:Z.a.valueInput,name:"parameters[".concat(e,"].value"),label:O.t("Value"),component:o.m,validate:ee})),i.a.createElement("div",{className:Z.a.checkboxGroup},i.a.createElement(Q,{dataTest:g("gateways-gatewaykeyvaluepair-isheader"),className:Z.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].header"),label:O.t("Send as header"),component:o.g}),i.a.createElement(Q,{dataTest:g("gateways-gatewaykeyvaluepair-isencoded"),className:Z.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].encode"),label:O.t("Encode"),component:o.g}),i.a.createElement(Q,{dataTest:g("gateways-gatewaykeyvaluepair-isconfidential"),className:Z.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].confidential"),label:O.t("Confidential"),component:o.g})),i.a.createElement(o.c,{dataTest:g("gateways-gatewaykeyvaluepair-remove"),onClick:()=>(e=>{const{parameters:n}=t().values;a("parameters",0===e?n.slice(1):[...n.slice(0,e),...n.slice(e+1)])})(e)},O.t("Remove key value pair"))))};var te=t(11);const ne=({onConfirmCancel:e,onAbortCancel:a})=>i.a.createElement(o.p,null,i.a.createElement(o.s,null,O.t("Are you sure you want to cancel? Unsaved changes will be lost")),i.a.createElement(o.q,null,i.a.createElement(o.d,null,i.a.createElement(o.c,{primary:!0,onClick:e},O.t("Yes, cancel")),i.a.createElement(o.c,{onClick:a},O.t("No, stay on page")))));var le=t(195),re=t.n(le);const se="".concat("/sms-gateway/edit","/:id"),ce=()=>{var e;const a=Object(c.f)(),{id:t}=Object(c.h)(),[n,l]=Object(m.useState)(!1),{loading:r,error:s,data:d}=_e(t),[u,{error:E}]=Fe(),[p,{error:b}]=Re(),[f,{error:y}]=je(),v=E||b||y;if(r)return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,O.t("Edit")),i.a.createElement(o.e,null,i.a.createElement(o.h,null)));if(s){const e=O.t("Something went wrong whilst loading gateways");return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,O.t("Edit")),i.a.createElement(o.t,{error:!0,title:e},s.message))}const S=d&&"string"===typeof d.gateway?{gateway:JSON.parse(d.gateway)}:d,C=(e=>{if(e===ge)return Y;if(e===pe)return J;if(e===be)return W;throw new Error('The gateway type does not exist, got "'.concat(e,'"'))})(null===S||void 0===S||null===(e=S.gateway)||void 0===e?void 0:e.type);return i.a.createElement("div",{"data-test":g("views-gatewayconfigformedit"),className:re.a.container},i.a.createElement(h,null,O.t("Edit gateway")),(null===S||void 0===S?void 0:S.gateway)&&i.a.createElement("div",{"data-test":g("views-gatewayconfigformedit-formcontainer"),"data-gateway-id":S.gateway.uid},v&&i.a.createElement(o.t,{error:!0,title:O.t("Something went wrong whilst saving gateways")},v.message),i.a.createElement(C,{initialValues:S.gateway,onSubmit:async e=>{const t=Object(te.a)(Object(te.a)({},e),{},{id:S.gateway.uid});try{t.type===ge&&await u(t),t.type===pe&&await p(t),t.type===be&&await f(t),a.push(Be)}catch(n){return Promise.reject(n)}},onCancelClick:e=>e?a.push(Be):l(!0)})),n&&i.a.createElement(ne,{onConfirmCancel:()=>a.push(Be),onAbortCancel:()=>l(!1)}))};var oe=t(201),me=t.n(oe);const ie=({allGatewaysChecked:e,checkedGateways:a,gateways:t,onGatewayToggle:n,onToggleAll:l,onMakeDefaultClick:r})=>{const s=Object(c.f)();return i.a.createElement(o.z,{dataTest:g("gateways-gatewaystable")},i.a.createElement(o.E,null,i.a.createElement(o.G,null,i.a.createElement(o.C,{dataTest:g("gateways-gatewaystable-checkall")},i.a.createElement(o.f,{onChange:l,checked:e})),i.a.createElement(o.C,null,O.t("Name")),i.a.createElement(o.C,null,O.t("Type")),i.a.createElement(o.C,null),i.a.createElement(o.C,null))),i.a.createElement(o.A,null,t.map(e=>{return i.a.createElement(o.F,{key:e.uid,dataTest:g("gateways-gatewaystable-row")},i.a.createElement(o.B,{className:me.a.checkboxCell,dataTest:g("gateways-gatewaystable-checkbox")},i.a.createElement(o.f,{value:e.uid,onChange:()=>n(e.uid),checked:a.includes(e.uid),dataTest:g("gateways-gatewaystable-id")})),i.a.createElement(o.B,{dataTest:g("gateways-gatewaystable-name")},e.name),i.a.createElement(o.B,{className:me.a.typeCell,dataTest:g("gateways-gatewaystable-type")},"bulksms"===(t=e.type)?O.t("BulkSMS"):"clickatell"===t?O.t("Clickatell"):"http"!==t&&t?t:O.t("Generic")),i.a.createElement(o.B,{className:me.a.defaultCell},e.isDefault?i.a.createElement("span",{className:me.a.isDefaultText},O.t("Default gateway")):i.a.createElement(o.c,{dataTest:g("gateways-gatewaystable-makedefault"),onClick:()=>r(e.uid),className:me.a.makeDefaultButton},O.t("Make default"))),i.a.createElement(o.B,{dataTest:g("gateways-gatewaystable-actions"),className:me.a.editCell},i.a.createElement(o.d,{className:me.a.rowActions},i.a.createElement(o.c,{dataTest:g("gateways-gatewaystable-edit"),onClick:()=>{s.push("".concat("/sms-gateway/edit","/").concat(e.uid))}},O.t("Edit")))));var t})))};var de=t(202),ue=t.n(de);const Ee=({checkedGateways:e,gateways:a,setCheckedGateways:t,onMakeDefaultClick:n,processing:l})=>{const r=e.length===a.length;return i.a.createElement("div",{className:ue.a.container,"data-test":g("gateways-gatewaylist")},l&&i.a.createElement("div",{className:ue.a.processingMessage},i.a.createElement("div",{className:ue.a.loadingContainer},i.a.createElement(o.h,null))),i.a.createElement(ie,{allGatewaysChecked:r,gateways:a,checkedGateways:e,onGatewayToggle:a=>{if(e.includes(a)){const n=e.findIndex(e=>e===a),l=0===n?e.slice(1):[...e.slice(0,n),...e.slice(n+1)];t(l)}else t([...e,a])},onMakeDefaultClick:n,onToggleAll:()=>{if(r)t([]);else{const e=a.map(({uid:e})=>e);t(e)}}}))},ge="http",pe="bulksms",be="clickatell";var fe=t(8);const ye={resource:"gateways",type:"create",data:({name:e,username:a,password:t})=>({type:"bulksms",name:e,username:a,password:t})},he={resource:"gateways",type:"create",data:({name:e,username:a,authtoken:t,urlTemplate:n})=>({type:"clickatell",name:e,username:a,authtoken:t,urlTemplate:n})},ve={resource:"gateways",type:"create",data:({name:e,urlTemplate:a,parameters:t})=>({type:"http",name:e,urlTemplate:a,parameters:t})},Se={resource:"gateways",type:"delete",id:({id:e})=>e},Ce=()=>{const[e,a]=Object(m.useState)(!1),[t,n]=Object(m.useState)(null),l=(e=>a=>{const t={id:a};return e.mutate(Se,{variables:t})})(Object(fe.c)()),r=e=>(a(!1),e),s=e=>{n(e),a(!1)};return[({ids:e})=>(a(!0),Promise.all(e.map(l)).then(r).catch(s)),{loading:e,error:t}]},we={gateway:{resource:"gateways",id:({id:e})=>e}},_e=e=>Object(fe.e)(we,{variables:{id:e}});var Oe=t(178);const Ae={gateways:{resource:"gateways.json",params:({fields:e,filter:a})=>{const t={};return e&&(t.fields=e),a&&(t.filter=a),t}}},Ne={resource:"gateways/default",type:"replace",id:({id:e})=>e},Te=e=>{const[a,t]=Object(m.useState)(!1),[n,l]=Object(m.useState)(null),r=Object(fe.c)();return[a=>{const n=Object(te.a)(Object(te.a)({},e),{},{id:a.id});return t(!0),l(null),r.mutate(n,{variables:a}).then(e=>(t(!1),e)).catch(e=>{throw t(!1),l(e),e})},{loading:a,error:n}]},ke={resource:"gateways",id:({id:e})=>e,type:"update",data:({name:e,username:a,password:t})=>({type:"bulksms",name:e,username:a,password:t})},Re=()=>Te(ke),Me={resource:"gateways",id:({id:e})=>e,type:"update",data:({name:e,username:a,authtoken:t,urlTemplate:n})=>({type:"clickatell",name:e,username:a,authtoken:t,urlTemplate:n})},je=()=>Te(Me),De={resource:"gateways",id:({id:e})=>e,type:"replace",data:({name:e,urlTemplate:a,parameters:t})=>({type:"http",name:e,urlTemplate:a,parameters:t})},Fe=()=>Te(De);var Ie=t(203),Pe=t.n(Ie);const xe=()=>{const e=Object(c.f)(),[a,t]=Object(m.useState)(ge),[n,{error:l}]=Object(fe.d)(ve);b(l);const[r,{error:s}]=Object(fe.d)(ye);b(s);const[d,{error:u}]=Object(fe.d)(he);b(u);const E=async t=>{try{a===ge&&await n(t),a===pe&&await r(t),a===be&&await d(t),e.push(Be)}catch(l){return Promise.reject(l)}};return i.a.createElement("div",{"data-test":g("views-gatewayconfigformnew"),className:Pe.a.container},i.a.createElement(h,null,O.t("Add gateway")),i.a.createElement(B,null,i.a.createElement(o.w,{label:O.t("Type"),onChange:({selected:e})=>t(e),selected:a,dataTest:g("views-gatewayconfigformnew-gatewaytype")},i.a.createElement(o.y,{value:ge,label:O.t("Generic")}),i.a.createElement(o.y,{value:pe,label:O.t("BulkSMS")}),i.a.createElement(o.y,{value:be,label:O.t("Clickatell")}))),i.a.createElement(B,null,a===ge&&i.a.createElement(Y,{onSubmit:E}),a===pe&&i.a.createElement(J,{onSubmit:E,passwordRequired:!0}),a===be&&i.a.createElement(W,{onSubmit:E,passwordRequired:!0})))};var Ge=t(204),Le=t.n(Ge);const qe=({addLabel:e,deleteLabel:a,dataTest:t,onAddClick:n,onDeleteClick:l,disableAdd:r,disableDelete:s})=>i.a.createElement("div",{className:Le.a.container},i.a.createElement(o.d,{"data-test":g("".concat(t,"-actions"))},i.a.createElement(o.c,{primary:!0,onClick:n,disabled:r,dataTest:g("".concat(t,"-add"))},e),i.a.createElement(o.c,{destructive:!0,onClick:l,disabled:s,dataTest:g("".concat(t,"-delete"))},a)));var Ue=t(205),Ve=t.n(Ue);const Be="/sms-gateway",ze=()=>{var e;const a=Object(c.f)(),[t,n]=Object(m.useState)([]),[l,r]=Object(m.useState)(!1),{loading:s,error:d,data:u,refetch:E}=(e=>{var a;"id:in:[".concat(null===e||void 0===e?void 0:e.join(","),"]");const t={},n=Object(fe.e)(Ae,{variables:t}),{data:l}=n,r=Object(Oe.a)(n,["data"]),s=l&&"string"===typeof l.gateways?{gateways:JSON.parse(l.gateways)}:l,c=e&&(null===s||void 0===s||null===(a=s.gateways)||void 0===a?void 0:a.gateways)?{gateways:{gateways:s.gateways.gateways.filter(({uid:a})=>e.includes(a))}}:s;return Object(te.a)({data:c},r)})(),[p,{loading:b,error:f}]=Ce(),[y,{loading:v,error:S}]=Object(fe.d)(Ne),C=s||b||v;if(C)return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,"Gateway configuration"),i.a.createElement(o.e,null,i.a.createElement(o.h,null)));const w=d||f||S;if(w){const e=O.t("Something went wrong whilst performing the requested operation");return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,"Gateway configuration"),i.a.createElement(o.t,{error:!0,title:e},w.message))}return i.a.createElement("div",{className:Ve.a.container,"data-test":g("views-gatewayconfiglist")},i.a.createElement(h,null,"Gateway configuration"),i.a.createElement("p",null,O.t("There are five different types of gateways supported by the SMS service. SMSes can be sent if at least one of the gateway types has been configured. If more than one gateway has been configured they will all be used in a round-robin fashion for load balancing")),i.a.createElement(qe,{addLabel:O.t("Add gateway"),deleteLabel:O.t("Delete selected"),dataTest:"views-gatewayconfiglist",onAddClick:()=>a.push("/sms-gateway/new"),onDeleteClick:()=>r(!0),disableAdd:b,disableDelete:!t.length||b}),(null===u||void 0===u||null===(e=u.gateways)||void 0===e?void 0:e.gateways)&&i.a.createElement(Ee,{processing:C,checkedGateways:t,setCheckedGateways:n,gateways:u.gateways.gateways,onMakeDefaultClick:e=>{y({id:e}).then(E)}}),l&&i.a.createElement(A,{onCancelClick:()=>r(!1),onDeleteClick:()=>{p({ids:t}).then(E),r(!1)}}))};var Je=t(9);const Ke=w.a.t("Received"),We=[{value:"ALL",label:w.a.t("All")},{value:"FAILED",label:w.a.t("Failed")},{value:"INCOMING",label:w.a.t("Incoming")},{value:"PROCESSED",label:w.a.t("Processed")},{value:"PROCESSING",label:w.a.t("Processing")},{value:"SENT",label:w.a.t("Sent")},{value:"UNHANDLED",label:w.a.t("Unhandled")}],He={resource:"sms/inbound",type:"delete",params:({ids:e})=>({ids:e})},Ye=({selectedIds:e,onComplete:a})=>{const{addAlert:t}=Object(m.useContext)(E),[n]=Object(fe.d)(He,{onComplete:a,onError:e=>{t({type:"critical",message:e.message})}});return i.a.createElement(o.c,{destructive:!0,onClick:()=>n({ids:e.join()}),disabled:0===e.length},w.a.t("Delete selected"))},Xe=()=>{const e=new URLSearchParams(Object(c.g)().search);return{status:e.get("status")||"ALL",phoneNumber:e.get("phoneNumber")||"",page:parseInt(e.get("page")||1),pageSize:parseInt(e.get("pageSize")||50)}},Ze=e=>{const a=Object.keys(e).reduce((a,t)=>{const n=e[t];return n&&!("status"===t&&"ALL"===n)&&a.push("".concat(t,"=").concat(n)),a},[]).join("&");return"?".concat(a)};var Qe=t(206),$e=t.n(Qe);const{Form:ea,Field:aa}=o.u,ta=({loading:e})=>{const{status:a,phoneNumber:t,pageSize:n}=Xe(),l={status:a,phoneNumber:t},r=Object(c.f)();return i.a.createElement("div",{"data-test":g("views-receivedsms-filter"),className:$e.a.container},i.a.createElement(ea,{onSubmit:({status:e,phoneNumber:a})=>{r.push({search:Ze({status:e,phoneNumber:a,pageSize:n,page:1})})},initialValues:l},({handleSubmit:a,pristine:t})=>i.a.createElement("form",{onSubmit:a,className:$e.a.inputStrip},i.a.createElement(aa,{name:"status",component:o.x,options:We,label:w.a.t("Filter by status"),inputWidth:"200px"}),i.a.createElement(aa,{name:"phoneNumber",component:o.m,label:w.a.t("Filter by phone number"),className:$e.a.phoneNumberField,inputWidth:"300px"}),i.a.createElement(o.c,{large:!0,type:"submit",disabled:e||t},w.a.t("Filter")))))};var na=t(15),la=t.n(na),ra=t(207),sa=t.n(ra);const ca=["1","2","10","20","30","40","50","100"],oa=({page:e,pageCount:a,pageSize:t,total:n})=>{const l=Math.min((e-1)*t+1,n),r=Math.min(l+t-1,n),s=Array.from({length:a},(e,a)=>(a+1).toString()),{status:m,phoneNumber:d}=Xe(),u=Object(c.f)(),E=e=>{u.push({search:Ze({status:m,phoneNumber:d,pageSize:t,page:e})})};return i.a.createElement("div",{className:sa.a.container},i.a.createElement("div",{className:sa.a.verticalAlign},w.a.t("Show"),i.a.createElement(o.v,{dense:!0,selected:t.toString(),onChange:({selected:e})=>{u.push({search:Ze({status:m,phoneNumber:d,pageSize:e,page:1})})},className:sa.a.select},ca.map(e=>i.a.createElement(o.y,{key:e,value:e,label:e}))),w.a.t("per page")),i.a.createElement("div",{className:sa.a.verticalAlign},i.a.createElement("span",{className:sa.a.summary},w.a.t("Viewing {{firstItem}}-{{lastItem}} of {{total}}",{firstItem:l,lastItem:r,total:n})),i.a.createElement(o.c,{className:sa.a.buttonPrevious,small:!0,disabled:1===e,onClick:()=>E(e-1)},w.a.t("Previous")),i.a.createElement("span",null,w.a.t("Page")),i.a.createElement(o.v,{dense:!0,inputWidth:"600px",selected:e.toString(),onChange:({selected:e})=>E(e),className:sa.a.select},s.map(e=>i.a.createElement(o.y,{key:e,value:e,label:e}))),i.a.createElement("span",null,w.a.t("of {{pageCount}}",{pageCount:a})),i.a.createElement(o.c,{className:sa.a.buttonNext,small:!0,disabled:e===a,onClick:()=>E(e+1)},w.a.t("Next"))))};var ma=t(208),ia=t.n(ma);const da=({messages:e,pager:a,selectedIds:t,setSelectedIds:n})=>{const l=new Set(t),r=e.length>0&&t.length===e.length,s=e=>{l.has(e)?l.delete(e):l.add(e),n(Array.from(l))};return i.a.createElement(o.z,null,i.a.createElement(o.E,null,i.a.createElement(o.G,null,i.a.createElement(o.C,null,i.a.createElement(o.f,{checked:r,onChange:()=>{n(r?[]:e.map(({id:e})=>e))}})),i.a.createElement(o.C,null,w.a.t("Message")),i.a.createElement(o.C,null,w.a.t("Phone number")),i.a.createElement(o.C,null,w.a.t("Status")),i.a.createElement(o.C,null,w.a.t("Sender")),i.a.createElement(o.C,null,w.a.t("Date")))),i.a.createElement(o.A,null,0===e.length?i.a.createElement(o.F,null,i.a.createElement(o.B,{colSpan:"7",className:ia.a.noResults},w.a.t("No SMSes to display"))):e.map(e=>i.a.createElement(o.F,{key:e.id},i.a.createElement(o.B,null,i.a.createElement(o.f,{checked:l.has(e.id),onChange:s.bind(null,e.id)})),i.a.createElement(o.B,null,e.text),i.a.createElement(o.B,null,i.a.createElement("span",{className:ia.a.originator},e.originator)),i.a.createElement(o.B,null,e.smsstatus),i.a.createElement(o.B,null,e.user?e.user.userCredentials.username:w.a.t("Unknown")),i.a.createElement(o.B,null,la()(e.receivedDate).format("MMMM Do YYYY, h:mm:ss a"))))),i.a.createElement(o.D,null,i.a.createElement(o.F,null,i.a.createElement(o.B,{colSpan:"7"},i.a.createElement(oa,a)))))},ua=({message:e})=>i.a.createElement(o.t,{error:!0,title:w.a.t("Could not load list of received SMSes")},e),Ea=()=>i.a.createElement(o.i,null,i.a.createElement(o.e,null,i.a.createElement(o.h,null)));var ga=t(209),pa=t.n(ga);const ba={inboundSms:{resource:"sms/inbound",params:({page:e,pageSize:a,phoneNumber:t,status:n})=>({page:e,pageSize:a,phoneNumber:t,status:n,fields:["id","text","originator","smsstatus","user[userCredentials[username]]","receiveddate"]})}},fa=()=>{const[e,a]=Object(m.useState)([]),{page:t,pageSize:n,phoneNumber:l,status:r}=Xe(),{called:s,loading:c,error:o,data:d,refetch:u}=Object(Je.d)(ba,{lazy:!0});return Object(m.useEffect)(()=>{u({page:t,pageSize:n,phoneNumber:l,status:r})},[t,n,l,r]),i.a.createElement("div",{"data-test":g("views-receivedsmslist"),className:pa.a.container},i.a.createElement(h,null,Ke),i.a.createElement("div",{className:pa.a.topBar},i.a.createElement(ta,{loading:c}),i.a.createElement(Ye,{onComplete:()=>{u(),a([])},selectedIds:e})),i.a.createElement("div",null,(c||!s)&&i.a.createElement(Ea,null),o&&!c&&i.a.createElement(ua,{message:o.message}),d&&i.a.createElement(da,{messages:d.inboundSms.inboundsmss,pager:d.inboundSms.pager,selectedIds:e,setSelectedIds:a})))},ya="completenessMethod",ha="defaultMessage",va="id",Sa="moreThanOneOrgUnitMessage",Ca="name",wa="noUserMessage",_a="parserType",Oa="program",Aa="programStage",Na="separator",Ta="smsCodes",ka="specialCharacters",Ra="successMessage",Ma="currentPeriodUsedForReporting",ja="wrongFormatMessage",Da="receivedMessage",{useForm:Fa}=o.u,Ia=()=>{const{change:e,getState:a}=Fa();return i.a.createElement(B,null,i.a.createElement(o.c,{onClick:()=>{const t=[...a().values[ka],{name:"",value:""}];e(ka,t)},dataTest:g("forms-commandsaddspecialcharacters")},O.t("Add special character")))},Pa={value:"ALL_DATAVALUE",label:O.t("Receive all data value")},xa={value:"AT_LEAST_ONE_DATAVALUE",label:O.t("Receive at least one data value")},Ga={value:"DO_NOT_MARK_COMPLETE",label:O.t("Do not mark as complete")},La=({commands:e,onCancelClick:a,onDeleteClick:t})=>i.a.createElement(o.p,{dataTest:g("commands-deleteconfirmationdialog")},i.a.createElement(o.s,null,O.t("Delete confirmation")),i.a.createElement(o.r,null,e&&i.a.createElement(o.z,null,i.a.createElement(o.E,null,i.a.createElement(o.G,null,i.a.createElement(o.C,null,O.t("Name")))),i.a.createElement(o.A,null,e.map(e=>i.a.createElement(o.F,{key:e.id},i.a.createElement(o.B,null,e.displayName)))))),i.a.createElement(o.q,null,i.a.createElement(o.d,null,i.a.createElement(o.c,{secondary:!0,onClick:a,dataTest:g("commands-deleteconfirmationdialog-cancel")},O.t("Cancel")),i.a.createElement(o.c,{primary:!0,onClick:t,dataTest:g("commands-deleteconfirmationdialog-confirm")},O.t("Delete command configurations"))))),{useFormState:qa}=o.u,Ua={submitting:!0,pristine:!0},Va=()=>{const{submitting:e,pristine:a}=qa({subscription:Ua});return i.a.createElement(o.c,{primary:!0,type:"submit",disabled:a||e,icon:e?i.a.createElement(o.h,{small:!0}):null},e?O.t("Submitting..."):O.t("Save command"))},{useFormState:Ba}=o.u,za={submitError:!0,hasSubmitErrors:!0},Ja=()=>{const{submitError:e,hasSubmitErrors:a}=Ba({subscription:za});return a?i.a.createElement(B,null,i.a.createElement(o.t,{error:!0,title:O.t("Something went wrong whilst submitting the form")},e)):null},Ka=(e,a)=>e===a.value,Wa={resource:"smsCommands",type:"create",data:({parserType:e,name:a,dataset:t,userGroup:n,program:l,programStage:r})=>{if(e===Lt.value||e===qt.value)return{parserType:e,name:a,dataset:t};if(e===Ut.value||e===Vt.value)return{parserType:e,name:a,userGroup:{id:n}};if(e===Bt.value||e===Jt.value)return{parserType:e,name:a,program:l};if(e===zt.value)return{parserType:e,name:a,program:l,programStage:r};throw new Error('You provided an unrecognized parserType "'.concat(e,'"'))}},Ha={resource:"smsCommands",type:"delete",id:({id:e})=>e},Ya=()=>{const[e,a]=Object(m.useState)(!1),[t,n]=Object(m.useState)(null),l=(e=>a=>{const t={id:a};return e.mutate(Ha,{variables:t})})(Object(fe.c)()),r=e=>(a(!1),e),s=e=>{n(e),a(!1)};return[({ids:e})=>(a(!0),Promise.all(e.map(l)).then(r).catch(s)),{loading:e,error:t}]},Xa={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:"parserType",paging:"false"}}},Za={smsCommands:{resource:"smsCommands",pager:!1,params:({ids:e}={})=>({paging:"false",fields:"*",filter:e?"ids:in:[".concat(e.join(","),"]"):void 0})}},{FORM_ERROR:Qa}=o.l,$a=e=>e,et={resource:"smsCommands",type:"update",id:({commandId:e})=>e,data:e=>{let{commandId:a}=e;return Object(Oe.a)(e,["commandId"])}},at=Object(te.a)(Object(te.a)({},et),{},{partial:!0}),tt=({onAfterChange:e,commandId:a,formatCommand:t=$a,replace:n=!1})=>{const{addAlert:l}=Object(m.useContext)(E),r=Object(fe.c)();return s=>{const c={variables:Object(te.a)(Object(te.a)({},t(s)),{},{commandId:a})},o=n?at:et;return r.mutate(o,c).then(e).catch(e=>{if("access"===e.type){const a="No error message was provided",t=e.message||O.t(a);return{[Qa]:t}}l({type:"critical",message:e.message})})}},{Field:nt}=o.u,lt=({dataSets:e,loading:a,required:t,disabled:n})=>i.a.createElement(nt,{disabled:n,required:t,loading:a,dataTest:g("forms-fielddataset"),name:"dataset",label:O.t("Dataset"),component:o.x,options:e,validate:o.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});lt.defaultProps={disabled:!1,loading:!1,required:!1};const rt={dataSets:{resource:"dataSets",params:{fields:["id","displayName"],paging:"false"}}},st=({required:e})=>{const{loading:a,error:t,data:n}=Object(fe.e)(rt);if(b(t),a)return i.a.createElement(lt,{loading:!0,showLoadingStatus:!0,required:e,dataSets:[]});if(t)return i.a.createElement(lt,{required:e,disabled:!0,dataSets:[]});const{dataSets:l}=n.dataSets,r=l.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(lt,{required:e,dataSets:r})};st.defaultProps={required:!1};const ct={dataSet:{resource:"dataSets",id:({id:e})=>e,params:({fields:e=["id","displayName"]}={})=>({fields:e})}},ot={dataElements:{resource:"dataElements",params:({ids:e})=>({filter:"id:in:[".concat(e.join(","),"]"),fields:"id,code,displayName,categoryCombo",paging:"false"})}},mt=(e,a)=>e.query(ot,{variables:a}).then(e=>Object(te.a)(Object(te.a)({},e),{},{dataElements:Object(te.a)(Object(te.a)({},e.dataElements),{},{dataElements:e.dataElements.dataElements.map(e=>{let{code:a}=e,t=Object(Oe.a)(e,["code"]);return Object(te.a)(Object(te.a)({},t),{},{code:a.replace("DE_","")})})})})),it=(e,a)=>{const t=Object(te.a)(Object(te.a)({},a),{},{fields:"dataSetElements"});return((e,a)=>e.query(ct,{variables:a}))(e,t).then(e=>{const a=e.dataSet,{dataSetElements:t}=a;return t.map(({dataElement:e})=>e.id)}).then(a=>{if(!a.length)return[];return mt(e,{ids:a})})},{Field:dt,Form:ut,useForm:Et,useFormState:gt}=o.u,pt=({combo:e,targetFieldName:a,onClose:t})=>{const n=Et(),{values:l}=gt(),{id:r}=l.dataset,{loading:s,error:c,data:d}=(e=>{const[a,t]=Object(m.useState)(!0),[n,l]=Object(m.useState)(null),[r,s]=Object(m.useState)(null),c=Object(fe.c)(),o=e=>(t(!0),l(null),it(c,e).then(s).catch(l).finally(()=>t(!1)));return Object(m.useEffect)(()=>{o({id:e})},[]),{loading:a,error:n,data:r,refetch:o}})(r);b(c);const u=((e,a)=>{let t=null;const n=e.split(".");if(!(a instanceof Object))return t;for(let l=0,r=a;l<n.length;++l){const e=r[n[l]];if(!e)break;if(l===n.length-1){t=e;break}r=e}return t})(a,l),E={operator:Object(m.useMemo)(()=>u?u[0]:"+",[]),dataElementCode:Object(m.useMemo)(()=>u?u.slice(1):"",[])};if(s)return i.a.createElement(o.p,null,i.a.createElement(o.h,null));c&&t();const g=d.dataElements.dataElements.map(e=>{const{code:a,displayName:t}=e;return{value:a,label:t}}),p=()=>{n.change(a,null),t()};return i.a.createElement(ut,{onSubmit:e=>{const l="".concat(e.operator).concat(e.dataElementCode);n.change(a,l),t()},initialValues:E},({handleSubmit:a})=>i.a.createElement(o.p,null,i.a.createElement(o.s,null,O.t("Formula for {{combo}}",{combo:e})),i.a.createElement(o.r,null,i.a.createElement("form",{onSubmit:e=>{e.stopPropagation(),a(e)}},i.a.createElement(B,null,i.a.createElement(dt,{required:!0,name:"dataElementCode",label:O.t("Data element"),component:o.x,options:g,validate:o.J})),i.a.createElement(B,null,i.a.createElement(dt,{required:!0,name:"operator",label:O.t("formula operator"),component:o.x,initialValue:"+",options:[{value:"+",label:"+"},{value:"-",label:"-"}]})),i.a.createElement(B,null,i.a.createElement(o.d,null,i.a.createElement(o.c,{type:"submit",primary:!0},O.t("Save")),i.a.createElement(o.c,{onClick:t},O.t("Cancel")),i.a.createElement(o.c,{onClick:p},O.t("Remove"))))))))},{useField:bt}=o.u,ft=({formulaFieldName:e,onClick:a})=>{const{input:t}=bt(e,{subscription:{value:!0}}),{value:n}=t;return i.a.createElement(i.a.Fragment,null,n&&O.t(),i.a.createElement(o.c,{onClick:a},n?O.t("Edit formula"):O.t("Add formula")))};var yt=t(210),ht=t.n(yt);const{Field:vt}=o.u,St=({dataElement:e,categoryOptionCombo:a})=>{const[t,n]=Object(m.useState)(!1),l=a?"".concat(e.displayName," ").concat(a.displayName):"".concat(e.displayName," ").concat(O.t("default")),r=((e,a)=>{const t=e.id,n=null===a||void 0===a?void 0:a.code;return!n||"default"===n?"".concat(Ta,".").concat(t):"".concat(Ta,".").concat(t,"-").concat(n)})(e,a),s="".concat(r,".code"),c="".concat(r,".formula");return i.a.createElement("div",{className:ht.a.container},i.a.createElement(vt,{className:ht.a.field,label:l,name:s,subscription:{value:!0,error:!0,invalid:!0,touched:!0}},e=>{let{input:a,meta:r}=e,s=Object(Oe.a)(e,["input","meta"]);const m=a.value;return i.a.createElement(i.a.Fragment,null,i.a.createElement(B,null,i.a.createElement(o.m,Object.assign({},s,{input:a,meta:r,error:!!r.error}))),m&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ft,{formulaFieldName:c,onClick:()=>n(!0)}),t&&i.a.createElement(pt,{combo:l,targetFieldName:c,onClose:()=>n(!1)})))}))};St.defaultProps={categoryOptionCombo:null,formula:""};var Ct=t(211),wt=t.n(Ct);const{FormSpy:_t}=o.u,Ot=({DE_COC_combinations:e})=>i.a.createElement("div",null,i.a.createElement("h2",null,O.t("SMS short codes")),i.a.createElement(_t,{subscription:{errors:!0,pristine:!0}},({errors:e,pristine:a})=>{if(a)return i.a.createElement("span",null);const t=e[Ta],n=null===t||void 0===t?void 0:t.global;return i.a.createElement(i.a.Fragment,null,n&&i.a.createElement(B,null,i.a.createElement(o.t,{error:!0,title:O.t("Data element category combination validation error")},n)))}),i.a.createElement("div",null,e.map(({dataElement:e,categoryOptionCombo:a})=>i.a.createElement(B,{className:wt.a.formRow,key:e.id+(null===a||void 0===a?void 0:a.id)},i.a.createElement(St,{dataElement:e,categoryOptionCombo:a})))));Ot.defaultProps={allRequired:!1};const{Field:At}=o.u,Nt=Object.values(n),Tt=()=>i.a.createElement(At,{dataTest:g("forms-fielddataset"),name:ya,label:O.t("Completeness method"),component:o.x,options:Nt}),{Field:kt}=o.u,Rt=()=>i.a.createElement(kt,{dataTest:g("commands-fieldcommandconfirmmessage"),name:Da,label:O.t("Confirm message"),component:o.H}),{Field:Mt}=o.u,jt=()=>i.a.createElement(Mt,{dataTest:g("forms-fieldcommanddefaultmessage"),name:ha,label:O.t("Reply message if no codes are sent (only the command)"),component:o.H}),{Field:Dt}=o.u,Ft=()=>i.a.createElement(Dt,{dataTest:g("forms-fieldcommandmorethanoneorgunitmessage"),name:Sa,label:O.t("More than one orgunit message"),component:o.H}),{Field:It}=o.u,Pt=()=>i.a.createElement(It,{required:!0,dataTest:g("commands-fieldcommandname"),name:Ca,label:O.t("Name"),component:o.m,validate:Object(o.I)(o.K,o.J)}),{Field:xt}=o.u,Gt=()=>i.a.createElement(xt,{dataTest:g("forms-fieldcommandnousermessage"),name:wa,label:O.t("No user message"),component:o.H}),Lt={value:"KEY_VALUE_PARSER",label:O.t("Key value parser")},qt={value:"J2ME_PARSER",label:O.t("J2ME parser")},Ut={value:"ALERT_PARSER",label:O.t("Alert parser")},Vt={value:"UNREGISTERED_PARSER",label:O.t("Unregistered parser")},Bt={value:"TRACKED_ENTITY_REGISTRATION_PARSER",label:O.t("Tracked entity registration parser")},zt={value:"PROGRAM_STAGE_DATAENTRY_PARSER",label:O.t("Program stage data entry parser")},Jt={value:"EVENT_REGISTRATION_PARSER",label:O.t("Event registration parser")},{Field:Kt}=o.u,Wt=Object.values(l).sort((e,a)=>e.label<a.label?-1:e.label>a.label?1:0),Ht=({disabled:e})=>i.a.createElement(Kt,{disabled:e,dataTest:g("forms-fieldcommandparser"),name:_a,label:O.t("Parser"),component:o.x,options:Wt});Ht.defaultProps={disabled:!1};const{Field:Yt}=o.u,Xt=()=>i.a.createElement(Yt,{dataTest:g("forms-fieldcommandseparator"),name:Na,label:O.t("Field separator"),component:o.m}),{Field:Zt,useFormState:Qt}=o.u,$t={values:!0},en=({id:e,displayName:a,valueType:t})=>{const{values:n}=Qt({subscription:$t}),l=n[Ta][e];return i.a.createElement(Zt,{required:!0,name:"".concat(Ta,".").concat(e),label:a,component:o.m,format:e=>(null===e||void 0===e?void 0:e.code)||"",parse:n=>l?Object(te.a)(Object(te.a)({},l),{},{code:n}):{code:n,trackedEntityAttribute:{id:e,displayName:a,valueType:t}}})};var an=t(212),tn=t.n(an);const{Field:nn,useForm:ln}=o.u,rn=({index:e})=>{const{change:a,getState:t}=ln();return i.a.createElement("div",{key:e,className:tn.a.container},i.a.createElement(nn,{required:!0,className:tn.a.field,dataTest:g("@TODO"),label:O.t("Special character name"),name:"".concat(ka,"[").concat(e,"].name"),component:o.m,validate:o.J}),i.a.createElement(nn,{required:!0,className:tn.a.field,dataTest:g("@TODO"),label:O.t("Special character value"),name:"".concat(ka,"[").concat(e,"].value"),component:o.m,validate:o.J}),i.a.createElement(o.k,{label:"\xa0"},i.a.createElement(o.c,{className:tn.a.button,onClick:()=>{const n=t().values[ka],l=[...n.slice(0,e),...n.slice(e+1)];a(ka,l)}},O.t("Remove"))))},{Field:sn}=o.u,cn=()=>i.a.createElement(sn,{dataTest:g("forms-fieldcommandsuccessmessage"),name:Ra,label:O.t("Success message"),component:o.H}),{Field:on}=o.u,mn=()=>i.a.createElement(on,{type:"checkbox",dataTest:g("forms-fieldusecurrentperiodforreporting"),name:Ma,label:O.t("Use current period for reporting"),component:o.g}),{Field:dn}=o.u,un=()=>i.a.createElement(dn,{dataTest:g("forms-fieldcommandwrongformatmessage"),name:ja,label:O.t("Wrong format message"),component:o.H}),{Field:En}=o.u,gn=({programStageDataElements:e,smsCodes:a})=>i.a.createElement(i.a.Fragment,null,e.map(({dataElement:e})=>i.a.createElement(En,{key:e.id,name:"".concat(Ta,".").concat(e.id),label:e.displayName,component:o.m,format:e=>(null===e||void 0===e?void 0:e.code)||null,parse:t=>{const n=a[e.id];return Object(te.a)(Object(te.a)({},n),{},{code:t||"",dataElement:e})}}))),{Field:pn}=o.u,bn=({userGroups:e,loading:a,required:t,disabled:n})=>i.a.createElement(pn,{disabled:n,required:t,loading:a,dataTest:g("forms-fielduserGroup"),name:"userGroup",label:O.t("Usergroup"),component:o.x,options:e,validate:t&&o.J});bn.defaultProps={disabled:!1,loading:!1,required:!1};const fn={userGroups:{resource:"userGroups",params:{paging:"false"}}},yn=({required:e})=>{const{loading:a,error:t,data:n}=Object(fe.e)(fn);if(b(t),a)return i.a.createElement(bn,{required:e,loading:!0,showLoadingStatus:!0,userGroups:[]});if(t)return i.a.createElement(bn,{required:e,disabled:!0,userGroups:[]});const{userGroups:l}=n.userGroups,r=l.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(bn,{required:e,userGroups:r})};yn.defaultProps={required:!1};const{Form:hn}=o.u,vn={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","receivedMessage","userGroup[name,id]"]}}},Sn=({commandId:e,onAfterChange:a,onCancel:t})=>{const n=tt({commandId:e,onAfterChange:a,replace:!0}),{loading:l,error:r,data:s}=Object(fe.e)(vn,{variables:{commandId:e}});if(l)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));if(r){const e=O.t("Something went wrong whilst loading the sms command");return i.a.createElement(o.t,{error:!0,title:e},r.message)}const{name:c,parserType:m,receivedMessage:d,userGroup:u}=s.smsCommand,E={name:c,parserType:m,receivedMessage:d,userGroup:u.id},p=[{value:u.id,label:u.name}];return i.a.createElement(hn,{keepDirtyOnReinitialize:!0,onSubmit:n,initialValues:E},({handleSubmit:e,pristine:a})=>i.a.createElement("form",{onSubmit:e,"data-test":g("commands-commandunregisteredparserform")},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(bn,{disabled:!0,userGroups:p})),i.a.createElement(B,null,i.a.createElement(Rt,null)),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t(a)},O.t("Cancel")),i.a.createElement(Va,null))))},{Field:Cn}=o.u,wn=({programs:e,loading:a,required:t,disabled:n})=>i.a.createElement(Cn,{disabled:n,required:t,loading:a,dataTest:g("forms-fieldprogram"),name:"program",label:O.t("Program"),component:o.x,options:e,validate:t&&o.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});wn.defaultProps={disabled:!1,loading:!1,required:!1};const _n={programs:{resource:"programs",params:({registration:e})=>{const a={paging:"false"};if("undefined"!==typeof e){const t=e?"programType:eq:WITH_REGISTRATION":"programType:eq:WITHOUT_REGISTRATION";a.filter=t}return a}}},On=({required:e,registration:a})=>{const t={registration:a},{loading:n,error:l,data:r}=(e=>Object(fe.e)(_n,{variables:{registration:e}}))({variables:t});if(b(l),n)return i.a.createElement(wn,{required:e,loading:!0,showLoadingStatus:!0,programs:[]});if(l)return i.a.createElement(wn,{required:e,disabled:!0,programs:[]});const{programs:s}=r.programs,c=s.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(wn,{required:e,programs:c})};On.defaultProps={required:!1,registration:void 0};const{Form:An}=o.u,Nn=e=>Object(te.a)(Object(te.a)({},e),{},{[Ta]:Object.values(e[Ta])}),Tn={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","separator","defaultMessage","wrongFormatMessage","noUserMessage","moreThanOneOrgUnitMessage","successMessage","program[id,displayName,programTrackedEntityAttributes[trackedEntityAttribute[:all,id,displayName]]]","smsCodes[:all,trackedEntityAttribute[id,displayName,valueType]]"]}}},kn=({commandId:e,onAfterChange:a,onCancel:t})=>{const n=tt({commandId:e,onAfterChange:a,formatCommand:Nn}),{loading:l,error:r,data:s}=Object(fe.e)(Tn,{variables:{commandId:e}});if(l)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));if(r){const e=O.t("Something went wrong whilst loading the sms command");return i.a.createElement(o.t,{error:!0,title:e},r.message)}const{name:c,parserType:m,program:d,separator:u,defaultMessage:E,wrongFormatMessage:g,noUserMessage:p,moreThanOneOrgUnitMessage:b,successMessage:f,smsCodes:y}=s.smsCommand,h=y.reduce((e,a)=>Object(te.a)(Object(te.a)({},e),{},{[a.trackedEntityAttribute.id]:a}),{}),v={name:c,parserType:m,program:d,separator:u,defaultMessage:E,wrongFormatMessage:g,noUserMessage:p,moreThanOneOrgUnitMessage:b,successMessage:f,smsCodes:h},S={value:d.id,label:d.displayName},C=d.programTrackedEntityAttributes.map(({trackedEntityAttribute:e})=>e).map(e=>{const{id:a,displayName:t,valueType:n}=e,l={id:a,displayName:t,valueType:n},r=h[a];return r&&(l.initialValue=r.code),l});return i.a.createElement(An,{keepDirtyOnReinitialize:!0,onSubmit:n,initialValues:v},({handleSubmit:e,pristine:a})=>i.a.createElement("form",{onSubmit:e},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(wn,{disabled:!0,programs:[S]})),i.a.createElement(B,null,i.a.createElement(Xt,null)),i.a.createElement(B,null,i.a.createElement(jt,null)),i.a.createElement(B,null,i.a.createElement(un,null)),i.a.createElement(B,null,i.a.createElement(Gt,null)),i.a.createElement(B,null,i.a.createElement(Ft,null)),i.a.createElement(B,null,i.a.createElement(cn,null)),i.a.createElement("h2",null,O.t("SMS short codes")),C.map(e=>i.a.createElement(B,{key:e.id},i.a.createElement(en,{id:e.id,displayName:e.displayName,valueType:e.valueType}))),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t(a)},O.t("Cancel")),i.a.createElement(Va,null))))},{Field:Rn}=o.u,Mn=({programStages:e,disabled:a,loading:t,required:n})=>i.a.createElement(Rn,{disabled:a,required:n,loading:t,dataTest:g("forms-fieldprogramStage"),name:"programStage",label:O.t("Program stage"),component:o.x,options:e,validate:n&&o.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});Mn.defaultProps={disabled:!1,loading:!1,required:!1};const jn={programStages:{resource:"programStages",params:({programId:e})=>({paging:"false",filter:e?"program.id:eq:".concat(e):void 0})}},Dn=({required:e,programId:a})=>{var t;const{loading:n,error:l,data:r,refetch:s}=(({programId:e,lazy:a})=>Object(fe.e)(jn,{variables:{programId:e},lazy:a}))({lazy:!0});if(b(l),Object(m.useEffect)(()=>{a&&s({programId:a})},[a]),n)return i.a.createElement(Mn,{loading:!0,required:e,programStages:[]});if(l)return i.a.createElement(Mn,{disabled:!0,required:e,programStages:[]});if(!a||!r)return i.a.createElement(Mn,{disabled:!0,required:e,programStages:[]});const c=((null===r||void 0===r||null===(t=r.programStages)||void 0===t?void 0:t.programStages)||[]).map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(Mn,{required:e,programStages:c})};Dn.defaultProps={required:!1};const Fn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","program[id,displayName]","programStage[id,displayName,programStageDataElements[dataElement[id,displayName]]]"],paging:"false"}}},{Form:In}=o.u,Pn=e=>Object(te.a)(Object(te.a)({},e),{},{[Ta]:Object.values(e[Ta])}),xn=({commandId:e,onAfterChange:a,onCancel:t})=>{const{error:n,data:l}=(r=e,Object(fe.e)(Fn,{variables:{id:r}}));var r;const s=null===l||void 0===l?void 0:l.smsCommand,c=null===s||void 0===s?void 0:s.programStage.programStageDataElements,m=tt({commandId:e,onAfterChange:a,formatCommand:Pn});if(n){const e=O.t("Something went wrong whilst loading the command's details");return i.a.createElement(o.t,{error:!0,title:e},n.message)}if(!s)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));const d=(e=>{const a=e[Ca],t=e[Oa],n=e[Aa],l=e[Na],r=e[ha],s=e[ja],c=e[wa],o=e[Sa],m=e[Ra],i=e[Ta].reduce((e,a)=>Object(te.a)(Object(te.a)({},e),{},{[a.dataElement.id]:a}),{});return{[Ca]:a,[_a]:zt.value,[Oa]:t,[Aa]:n,[Na]:l,[ha]:r,[ja]:s,[wa]:c,[Sa]:o,[Ra]:m,[Ta]:i}})(s),u={value:s.program.id,label:s.program.displayName},E={value:s.programStage.id,label:s.programStage.displayName};return i.a.createElement(In,{keepDirtyOnReinitialize:!0,onSubmit:m,initialValues:d},({handleSubmit:e,values:a,pristine:n})=>i.a.createElement("form",{onSubmit:e,"data-test":g("commands-commandeditprogramstagedataentryparserform")},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(wn,{disabled:!0,programs:[u]})),i.a.createElement(B,null,i.a.createElement(Mn,{disabled:!0,programStages:[E]})),i.a.createElement(B,null,i.a.createElement(Xt,null)),i.a.createElement(B,null,i.a.createElement(jt,null)),i.a.createElement(B,null,i.a.createElement(un,null)),i.a.createElement(B,null,i.a.createElement(Gt,null)),i.a.createElement(B,null,i.a.createElement(Ft,null)),i.a.createElement(B,null,i.a.createElement(cn,null)),c&&i.a.createElement(B,null,i.a.createElement("h2",null,O.t("SMS short codes")),i.a.createElement(gn,{programStageDataElements:c,smsCodes:a[Ta]})),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t(n)},O.t("Cancel")),i.a.createElement(Va,null))))},Gn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","dataset[id,displayName,dataSetElements[dataElement[id,displayName,categoryCombo[categoryOptionCombos[id,displayName,code]]]]"],paging:"false"}}},{Form:Ln,FormSpy:qn}=o.u,Un=e=>a=>{let t=!1;const n={},l=a[ya],r=a[Ta],s=(r?Object.entries(r):[]).filter(([e,{code:a}])=>a);if(l===Pa.value&&s.length!==(null===e||void 0===e?void 0:e.length)?(t=!0,n[Ta]=n[Ta]||{},n[Ta]={global:O.t('With completeness method "'.concat(Pa.label,'", all sms codes need to have a value'))}):l!==xa.value||s.length||(t=!0,n[Ta]=n[Ta]||{},Object.assign(n[Ta],{global:O.t('With completeness method "'.concat(xa.label,'", you need to provide at least one value'))})),s.length){const e=(e=>e.reduce((a,t,n)=>{const[l,r]=t;if(a.includes(l))return a;const s=e.filter(([e,a],t)=>a.code===r.code&&t!==n);if(!s.length)return a;const c=s.reduce((e,[a])=>[...e,a],[l]);return[...a,...c]},[]))(s);if(e.length){t=!0;const a={};e.forEach(e=>{a[e]={code:O.t("Duplicate value!")}}),n[Ta]=n[Ta]||{},Object.assign(n[Ta],a)}}return t?n:void 0},Vn=e=>{const a=e[Ta],t=Object.entries(a).map(([e,{code:a,formula:t,compulsory:n,optionId:l}])=>{const[r]=e.split("-"),s={code:a,compulsory:n,dataElement:{id:r}};return t&&(s.formula=t),l&&(s.optionId=l),s});return Object(te.a)(Object(te.a)({},e),{},{[Ta]:t})},Bn=({commandId:e,onAfterChange:a,dataTest:t,initialCompletenessMethod:n,onCancel:l})=>{const{error:r,data:s}=(c=e,Object(fe.e)(Gn,{variables:{id:c}}));var c;const m=null===s||void 0===s?void 0:s.smsCommand,d=tt({commandId:e,onAfterChange:a,formatCommand:Vn});if(r){const e=O.t("Something went wrong whilst loading the command's details");return i.a.createElement(o.t,{error:!0,title:e},r.message)}if(!m)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));const u={value:m.dataset.id,label:m.dataset.displayName},E=((e,a)=>{const t=e[Ca],n=Lt.value,l={id:e.dataset.id},r=e[Na],s=a||e[ya]||Pa.value,c=e[Ma],o=e[ha],m=e[ja],i=e[wa],d=e[Sa],u=e[Ra],E=e[Ta].reduce((e,{code:a,compulsory:t,formula:n,optionId:l,dataElement:r})=>{const s=l<10?r.id:"".concat(r.id,"-").concat(l),c={code:a,compulsory:t,optionId:l};return n&&(c.formula=n),Object(te.a)(Object(te.a)({},e),{},{[s]:c})},{}),g=e[ka]||[];return{[Ca]:t,[_a]:n,dataset:l,[Na]:r,[ya]:s,[Ma]:c,[ha]:o,[ja]:m,[wa]:i,[Sa]:d,[Ra]:u,smsCodes:E,specialCharacters:g}})(m,n),g=m.dataset.dataSetElements.reduce((e,{dataElement:a})=>{var t;const n=null===(t=a.categoryCombo)||void 0===t?void 0:t.categoryOptionCombo;if(!n)return[...e,{dataElement:a}];const l=n.map(e=>({dataElement:a,categoryOptionCombo:e}));return[...e,...l]},[]);return i.a.createElement(Ln,{keepDirtyOnReinitialize:!0,onSubmit:d,initialValues:E,validate:Un(g),subscription:{pristine:!0}},({handleSubmit:e,form:a,pristine:n})=>i.a.createElement("form",{onSubmit:e,"data-test":t},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(lt,{disabled:!0,dataSets:[u]})),i.a.createElement(B,null,i.a.createElement(Tt,null)),i.a.createElement(B,null,i.a.createElement(mn,null)),i.a.createElement(B,null,i.a.createElement(Xt,null)),i.a.createElement(B,null,i.a.createElement(jt,null)),i.a.createElement(B,null,i.a.createElement(un,null)),i.a.createElement(B,null,i.a.createElement(Gt,null)),i.a.createElement(B,null,i.a.createElement(Ft,null)),i.a.createElement(B,null,i.a.createElement(cn,null)),g&&i.a.createElement(Ot,{DE_COC_combinations:g}),i.a.createElement("div",null,i.a.createElement("h2",null,"Special characters"),i.a.createElement(qn,{subscription:{values:!0}},({values:e})=>i.a.createElement(i.a.Fragment,null,e[ka].map((e,a)=>i.a.createElement(B,{key:a},i.a.createElement(rn,{index:a}))))),i.a.createElement(Ia,null),i.a.createElement(B,null,i.a.createElement("hr",null))),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>l(n)},O.t("Cancel")),i.a.createElement(Va,null))))},zn=({commandId:e,onAfterChange:a,onCancel:t})=>i.a.createElement(Bn,{dataTest:g("smscommandkeyvalueparser-commandeditkeyvalueparserform"),commandId:e,onAfterChange:a,onCancel:t}),Jn=({commandId:e,onAfterChange:a,onCancel:t})=>i.a.createElement(Bn,{dataTest:g("smscommandkeyvalueparser-commandeditj2meparserform"),commandId:e,onAfterChange:a,onCancel:t,initialCompletenessMethod:xa.value}),Kn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","program[id,displayName]","programStage[id,displayName,programStageDataElements[id,dataElement[id,displayName]]"],paging:"false"}}},{Form:Wn}=o.u,Hn=e=>Object(te.a)(Object(te.a)({},e),{},{[Ta]:Object.values(e[Ta])}),Yn=({commandId:e,onAfterChange:a,onCancel:t})=>{const{error:n,data:{smsCommand:l}={}}=(r=e,Object(fe.e)(Kn,{variables:{id:r}}));var r;const s=tt({commandId:e,onAfterChange:a,formatCommand:Hn});if(n){const e=O.t("Something went wrong whilst loading the command's details");return i.a.createElement(o.t,{error:!0,title:e},n.message)}if(!l)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));const c={value:l.program.id,label:l.program.displayName},m={value:l.programStage.id,label:l.programStage.displayName},d=l.programStage.programStageDataElements,u=(e=>{const a=e[Ca],t=e[Oa],n=e[Aa],l=e[Na],r=e[ha],s=e[ja],c=e[wa],o=e[Sa],m=e[Ra],i=e[Ta].reduce((e,a)=>Object(te.a)(Object(te.a)({},e),{},{[a.dataElement.id]:a}),{});return{[Ca]:a,[_a]:Jt.value,[Oa]:t,[Aa]:n,[Na]:l,[ha]:r,[ja]:s,[wa]:c,[Sa]:o,[Ra]:m,[Ta]:i}})(l);return i.a.createElement(Wn,{keepDirtyOnReinitialize:!0,initialValues:u,onSubmit:s},({handleSubmit:e,values:a,pristine:n})=>i.a.createElement("form",{onSubmit:e},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(wn,{disabled:!0,programs:[c]})),i.a.createElement(B,null,i.a.createElement(Mn,{disabled:!0,programStages:[m]})),i.a.createElement(B,null,i.a.createElement(Xt,null)),i.a.createElement(B,null,i.a.createElement(jt,null)),i.a.createElement(B,null,i.a.createElement(un,null)),i.a.createElement(B,null,i.a.createElement(Gt,null)),i.a.createElement(B,null,i.a.createElement(Ft,null)),i.a.createElement(B,null,i.a.createElement(cn,null)),d&&i.a.createElement(B,null,i.a.createElement("h2",null,O.t("SMS short codes")),i.a.createElement(gn,{programStageDataElements:d,smsCodes:a[Ta]})),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t(n)},O.t("Cancel")),i.a.createElement(Va,null))))},{Form:Xn}=o.u,Zn={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","receivedMessage","userGroup[name,id]"]}}},Qn=({commandId:e,onAfterChange:a,onCancel:t})=>{const n=tt({commandId:e,onAfterChange:a,replace:!0}),{loading:l,error:r,data:s}=Object(fe.e)(Zn,{variables:{commandId:e}});if(l)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));if(r){const e=O.t("Something went wrong whilst loading the sms command");return i.a.createElement(o.t,{error:!0,title:e},r.message)}const{name:c,parserType:m,receivedMessage:d,userGroup:u}=s.smsCommand,E={name:c,parserType:m,receivedMessage:d,userGroup:u.id},p=[{value:u.id,label:u.name}];return i.a.createElement(Xn,{keepDirtyOnReinitialize:!0,onSubmit:n,initialValues:E},({handleSubmit:e,pristine:a})=>i.a.createElement("form",{onSubmit:e,"data-test":g("commands-commandeditalertparserform")},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,{disabled:!0})),i.a.createElement(B,null,i.a.createElement(bn,{disabled:!0,userGroups:p})),i.a.createElement(B,null,i.a.createElement(Rt,null)),i.a.createElement(Ja,null),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t(a)},O.t("Cancel")),i.a.createElement(Va,null))))};var $n=t(213),el=t.n($n);const al="".concat("/sms-config/edit","/:id"),tl=()=>{const e=Object(c.f)(),{id:a}=Object(c.h)(),{loading:t,error:n,data:l}=(e=>Object(fe.e)(Xa,{variables:{id:e}}))(a),[r,s]=Object(m.useState)(!1);if(t)return i.a.createElement(o.e,null,i.a.createElement(o.h,null));if(n){const e=O.t("Something went wrong whilst loading commands");return i.a.createElement(o.t,{error:!0,title:e},n.message)}const d=(e=>{const a=Ka.bind(null,e);return e&&a(Lt)?zn:e&&a(qt)?Jn:e&&a(Ut)?Qn:e&&a(zt)?xn:e&&a(Vt)?Sn:e&&a(Jt)?Yn:e&&a(Bt)?kn:null})(null===l||void 0===l?void 0:l.smsCommand[_a]);return i.a.createElement("div",{className:el.a.container},i.a.createElement(h,null,O.t("Edit command")),d&&i.a.createElement(d,{commandId:a,onCancel:a=>a?e.goBack():s(!0),onAfterChange:()=>e.push(ul)}),r&&i.a.createElement(ne,{onConfirmCancel:()=>e.push(ul),onAbortCancel:()=>s(!1)}))};var nl=t(214),ll=t.n(nl);const{Form:rl,useForm:sl}=o.u,cl=({handleSubmit:e,submitting:a})=>{(()=>{const e=sl(),[a,t]=Object(m.useState)(e.getState().values);Object(m.useEffect)(()=>e.subscribe(({values:n})=>{e.batch(()=>{const t=n[_a],l=n.program,r=n.programStage,s=a.program,c=a[_a];r&&(s&&l!==s||c&&t!==c)&&e.change("programStage",null)}),t(n)},{values:!0}),[a])})();const t=Object(c.f)(),n=sl(),{values:l}=n.getState(),r=l[_a],s=l.program,d=r===Lt.value||r===qt.value,u=r===Ut.value||r===Vt.value,E=r===Bt.value||r===zt.value||r===Jt.value,g=r===zt.value,p=r!==Jt.value&&void 0;return i.a.createElement("div",{className:ll.a.container},i.a.createElement(h,null,O.t("Add command")),i.a.createElement("form",{onSubmit:e},i.a.createElement(B,null,i.a.createElement(Pt,null)),i.a.createElement(B,null,i.a.createElement(Ht,null)),d&&i.a.createElement(B,null,i.a.createElement(st,null)),u&&i.a.createElement(B,null,i.a.createElement(yn,null)),E&&i.a.createElement(B,null,i.a.createElement(On,{registration:p})),g&&i.a.createElement(B,null,i.a.createElement(Dn,{programId:s||""})),i.a.createElement(o.d,null,i.a.createElement(o.c,{onClick:()=>t.goBack()},O.t("Cancel")),i.a.createElement(o.c,{primary:!0,type:"submit"},a?O.t("Submitting..."):O.t("Add command")))))},ol=()=>{const[e]=Object(fe.d)(Wa);return i.a.createElement(rl,{onSubmit:a=>e(a)},({handleSubmit:e,submitting:a})=>i.a.createElement(cl,{handleSubmit:e,submitting:a}))};var ml=t(215),il=t.n(ml);const dl=O.t("Commands"),ul="/sms-config",El=()=>{var e,a,t,n;const l=Object(c.f)(),[s,d]=Object(m.useState)([]),[u,E]=Object(m.useState)(!1),{loading:p,error:b,data:f,refetch:y}=Object(fe.e)(Za),[v,{loading:S,error:C}]=Ya();if(p)return i.a.createElement("div",{"data-test":g("views-smscommandlist")},i.a.createElement(h,null,dl),i.a.createElement(o.e,null,i.a.createElement(o.h,null)));const w=b||C;if(w){const e=O.t("Something went wrong whilst performing the requested operation");return i.a.createElement("div",{"data-test":g("views-smscommandlist")},i.a.createElement(h,null,dl),i.a.createElement(o.t,{error:!0,title:e},w.message))}const _=s.length===(null===f||void 0===f||null===(e=f.smsCommands)||void 0===e||null===(a=e.smsCommands)||void 0===a?void 0:a.length);return i.a.createElement("div",{"data-test":g("views-smscommandlist"),className:il.a.container},i.a.createElement(h,null,dl),i.a.createElement(qe,{addLabel:O.t("Add command"),deleteLabel:O.t("Delete selected"),dataTest:"views-smscommandlist",onAddClick:()=>l.push("/sms-config/new"),onDeleteClick:()=>E(!0),disableAdd:S,disableDelete:!s.length||S}),u&&i.a.createElement(La,{commands:s,onCancelClick:()=>E(!1),onDeleteClick:async()=>{const e=s.map(({id:e})=>e);await v({ids:e}),d([]),E(!1),y()}}),i.a.createElement(o.z,null,i.a.createElement(o.E,null,i.a.createElement(o.G,null,i.a.createElement(o.C,null,i.a.createElement(o.f,{checked:_,onChange:()=>{var e;const a=null===f||void 0===f||null===(e=f.smsCommands)||void 0===e?void 0:e.smsCommands;a&&(s.length===a.length?d([]):d(a.map(({id:e,displayName:a})=>({id:e,displayName:a}))))}})),i.a.createElement(o.C,null,O.t("Sms command")),i.a.createElement(o.C,null,O.t("Parser")),i.a.createElement(o.C,null))),i.a.createElement(o.A,null,null===f||void 0===f||null===(t=f.smsCommands)||void 0===t||null===(n=t.smsCommands)||void 0===n?void 0:n.map(({id:e,displayName:a,parserType:t})=>i.a.createElement(o.F,{key:e},i.a.createElement(o.B,{className:il.a.checkbox},i.a.createElement(o.f,{checked:!!s.find(({id:a})=>e===a),onChange:()=>(e=>{const{id:a}=e;if(s.find(({id:e})=>a===e)){const e=s.findIndex(({id:e})=>a===e);return d([...s.slice(0,e),...s.slice(e+1)])}return d([...s,e])})({id:e,displayName:a})})),i.a.createElement(o.B,null,a),i.a.createElement(o.B,null,(e=>{const a=Object.values(r).find(({value:a})=>a===e);return(null===a||void 0===a?void 0:a.label)||e})(t)),i.a.createElement(o.B,{className:il.a.editButtonCell},i.a.createElement(o.c,{onClick:()=>l.push("".concat("/sms-config/edit","/").concat(e))},O.t("Edit"))))))))},gl=()=>{throw new Error("RefetchSms consumer needs to have a valid Provider as parent")};var pl=Object(m.createContext)({refetch:gl,refetchAndClear:gl});const bl={resource:"sms/outbound",params:({ids:e})=>({ids:e}),type:"delete"};var fl=({selected:e})=>{const a=0===e.length,t=e.join(","),{addAlert:n}=Object(m.useContext)(E),{refetchAndClear:l}=Object(m.useContext)(pl),[r,{loading:s}]=Object(fe.d)(bl,{onComplete:()=>{l()},onError:e=>{n({type:"critical",message:e.message})}});return i.a.createElement(o.c,{destructive:!0,disabled:a||s,onClick:()=>r({ids:t})},O.t("Delete selected"))};const yl={DELIVERED:w.a.t("Delivered"),ERROR:w.a.t("Error"),FAILED:w.a.t("Failed"),OUTBOUND:w.a.t("Outbound"),PENDING:w.a.t("Pending"),SCHEDULED:w.a.t("Scheduled"),SENT:w.a.t("Sent")};var hl=t(216),vl=t.n(hl);var Sl=({sms:e,toggleSelected:a,isSelected:t})=>{const{message:n,status:l,date:r,id:s}=e,c=null===e.recipients?[]:e.recipients;return i.a.createElement(o.F,null,i.a.createElement(o.B,null,i.a.createElement(o.f,{onChange:()=>a(s),checked:t})),i.a.createElement(o.B,null,n),i.a.createElement(o.B,null,c.map((e,a,t)=>i.a.createElement("span",{key:e+a,className:vl.a.recipient},e,a!==t.length-1&&", "))),i.a.createElement(o.B,null,yl[l]),i.a.createElement(o.B,null,la()(r).format("MMMM Do YYYY, h:mm:ss a")))},Cl=t(217),wl=t.n(Cl);const _l=["10","20","30","40","50","100"];var Ol=({pager:e})=>{const{refetchAndClear:a}=Object(m.useContext)(pl),t=e=>{a({page:e})},{page:n,pageCount:l,pageSize:r,total:s}=e,c=Math.min((n-1)*r+1,s),d=Math.min(c+r-1,s),u=Array.from({length:l},(e,a)=>(a+1).toString());return i.a.createElement("div",{className:wl.a.container},i.a.createElement("div",{className:wl.a.left},i.a.createElement("span",null,O.t("Show")),i.a.createElement(o.v,{dense:!0,selected:r.toString(),onChange:({selected:e})=>{a({pageSize:e,page:1})}},_l.map(e=>i.a.createElement(o.y,{key:e,value:e,label:e}))),i.a.createElement("span",null,O.t("per page"))),i.a.createElement("div",{className:wl.a.right},i.a.createElement("div",{className:wl.a.amount},O.t("Viewing {{firstItem}}-{{lastItem}} of {{total}}",{firstItem:c,lastItem:d,total:s})),i.a.createElement(o.c,{small:!0,disabled:1===n,onClick:()=>t(n-1)},O.t("Previous")),i.a.createElement("div",{className:wl.a.pageselection},i.a.createElement("div",null,O.t("Page")),i.a.createElement(o.v,{dense:!0,selected:n.toString(),onChange:({selected:e})=>{t(e)}},u.map(e=>i.a.createElement(o.y,{key:e,value:e,label:e}))),i.a.createElement("div",null,O.t("of {{pageCount}}",{pageCount:l}))),i.a.createElement(o.c,{small:!0,disabled:n===l,onClick:()=>t(n+1)},O.t("Next"))))},Al=t(218),Nl=t.n(Al);var Tl=({smses:e,toggleSelected:a,toggleAll:t,allSelected:n,selected:l,pager:r})=>i.a.createElement(o.z,null,i.a.createElement(o.E,null,i.a.createElement(o.G,null,i.a.createElement(o.C,null,i.a.createElement(o.f,{disabled:0===e.length,onChange:t,checked:n})),i.a.createElement(o.C,null,O.t("Message")),i.a.createElement(o.C,null,O.t("Recipients")),i.a.createElement(o.C,null,O.t("Status")),i.a.createElement(o.C,null,O.t("Date")))),i.a.createElement(o.A,null,0===e.length?i.a.createElement(o.F,null,i.a.createElement(o.B,{colSpan:"7",className:Nl.a.noResults},O.t("No SMSes to display"))):e.map(e=>i.a.createElement(Sl,{key:e.id,sms:e,isSelected:l.includes(e.id),toggleSelected:a}))),i.a.createElement(o.D,null,i.a.createElement(o.F,null,i.a.createElement(o.B,{colSpan:"7"},i.a.createElement(Ol,{pager:r})))));const kl=e=>"ALL"===e?"":e,Rl=[{label:O.t("All"),value:"ALL"},...["DELIVERED","ERROR","FAILED","OUTBOUND","PENDING","SCHEDULED","SENT"].map(e=>({label:yl[e],value:e}))];var Ml=({status:e,setStatus:a})=>{const{refetchAndClear:t}=Object(m.useContext)(pl);return i.a.createElement(o.w,{label:O.t("Filter by status"),inputWidth:"200px",onChange:({selected:e})=>{a(e),t({status:kl(e),page:1})},selected:e},Rl.map(({label:e,value:a})=>i.a.createElement(o.y,{key:e,label:e,value:a})))},jl=t(219),Dl=t.n(jl);const Fl=O.t("Sent"),Il={sms:{resource:"sms/outbound",params:({status:e,page:a,pageSize:t})=>{const n={pageSize:t,page:a,fields:["id","message","status","date","recipients"]};return e?Object(te.a)(Object(te.a)({},n),{},{filter:"status:eq:".concat(e)}):n}}},Pl=()=>{const[e,a]=Object(m.useState)([]),[t,n]=Object(m.useState)("ALL"),{loading:l,error:r,data:s,refetch:c}=Object(fe.e)(Il,{variables:{status:kl(t),pageSize:10,page:1}});if(l)return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,Fl),i.a.createElement(o.e,null,i.a.createElement(o.h,null)));if(r){const e=O.t("Something went wrong whilst loading sent SMSes");return i.a.createElement(i.a.Fragment,null,i.a.createElement(h,null,Fl),i.a.createElement(o.t,{error:!0,title:e},r.message))}const d=s.sms.outboundsmss.map(e=>e.id);const u=((e,a)=>{const t=0===e.length,n=e.length!==a.length;return!t&&!n&&e.every(e=>a.includes(e))})(d,e),E=(({allSelected:e,setSelected:a,allIds:t})=>()=>a(e?[]:t))({allSelected:u,setSelected:a,allIds:d}),g=(({selected:e,setSelected:a})=>t=>{if(e.includes(t)){const n=e.filter(e=>e!==t);return a(n)}return a([...e,t])})({selected:e,setSelected:a}),p={refetch:c,refetchAndClear:e=>{a([]),c(e)}};return i.a.createElement("div",{className:Dl.a.container},i.a.createElement(pl.Provider,{value:p},i.a.createElement(h,null,Fl),i.a.createElement("div",{className:Dl.a.header},i.a.createElement(Ml,{status:t,setStatus:n}),i.a.createElement("div",{className:Dl.a.headerRight},i.a.createElement(fl,{selected:e}))),i.a.createElement(Tl,{smses:s.sms.outboundsmss,allSelected:u,selected:e,toggleSelected:g,toggleAll:E,pager:s.sms.pager})))},xl=({label:e,path:a,exactMatch:t})=>{const n=Object(c.f)(),l=((e,a)=>{const t=Object(c.i)(e);return!!t&&(!a||t.isExact)})(a,t);return i.a.createElement(o.o,{onClick:()=>n.push(a),active:l,label:e,dataTest:g("navigation-navigationitem")})};xl.defualtProps={exactMatch:!1};const Gl=()=>i.a.createElement(o.n,{dataTest:g("navigation-navigation")},i.a.createElement(xl,{path:"/",label:"Home",exactMatch:!0}),i.a.createElement(xl,{path:Be,label:"Gateway configuration"}),i.a.createElement(xl,{path:ul,label:dl}),i.a.createElement(xl,{path:"/sent",label:Fl}),i.a.createElement(xl,{path:"/received",label:Ke}));a.default=()=>i.a.createElement(p,null,i.a.createElement(o.j,{spacers:!0,colors:!0}),i.a.createElement(s.a,null,i.a.createElement(o.j,{colors:!0}),i.a.createElement("div",{className:u.a.container,"data-test":g("app")},i.a.createElement("div",{className:u.a.sidebar},i.a.createElement(Gl,null)),i.a.createElement("main",{className:u.a.content},i.a.createElement(c.c,null,i.a.createElement(c.a,{exact:!0,path:"/",component:v}),"",i.a.createElement(c.a,{exact:!0,path:Be,component:ze}),i.a.createElement(c.a,{exact:!0,path:se,component:ce}),i.a.createElement(c.a,{exact:!0,path:"/sms-gateway/new",component:xe}),"",i.a.createElement(c.a,{exact:!0,path:ul,component:El}),i.a.createElement(c.a,{exact:!0,path:al,component:tl}),i.a.createElement(c.a,{exact:!0,path:"/sms-config/new",component:ol}),"",i.a.createElement(c.a,{exact:!0,path:"/sent",component:Pl}),"",i.a.createElement(c.a,{exact:!0,path:"/received",component:fa}),i.a.createElement(c.a,{component:S}))))))}}]);
//# sourceMappingURL=app.5a11a6d9.chunk.js.map