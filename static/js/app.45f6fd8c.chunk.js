(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[132],{190:function(e,a,t){e.exports={container:"App_container__2zgzu",sidebar:"App_sidebar__10tAV",content:"App_content__3I8HS"}},191:function(e){e.exports=JSON.parse('{"Dataset":"","Confirm deletion":"","Are you sure you want to delete the selected gateways?":"","Auth token":"","Name":"","Password":"","Url template":"","User name":"","Add key value pair":"","Save gateway":"","Add gateway":"","With a generic http gateway any number of parameters can be added with key value pairs":"","Key":"","Value":"","Send as header":"","Encode":"","Confidential":"","Remove key value pair":"","Type":"","Default gateway":"","Yes":"","No":"","Make default":"","Edit":"","BulkSMS":"","Clickatell":"","Generic":"","Program":"","Program stage":"","Are you sure you want to delete the selected commands?":"","Cancel":"","Delete":"","Save command":"","Something went wrong whilst submitting the form":"","Something went wrong whilst loading the sms command":"","Something went wrong whilst loading the command\'s details":"","Program stage data elements":"","Add special character":"","Data element category combination":"","Data element category combination validation error":"","Completeness method":"","Confirm message":"","Reply message if no codes are sent (only the command)":"","More than one orgunit message":"","No user message":"","Parser":"","Field separator":"","Special character name":"","Special character value":"","Remove":"","Success message":"","Use current period for reporting":"","Wrong format message":"","default":"","Change formula":"","Data element":"","formula operator":"","Something went wrong whilst saving":"","Save":"","Receive all data value":"","Receive at least one data value":"","Do not mark as complete":"","Key value parser":"","J2ME parser":"","Alert parser":"","Unregistered parser":"","Tracked entity registration parser":"","Program stage data entry parser":"","Event registration parser":"","Tracked entity attribute":"","Duplicate value!":"","Usergroup":"","Something went wrong whilst loading gateways":"","Edit gateway":"","Something went wrong whilst saving gateways":"","Gateway not found":"","The requested gateway could not be loaded":"","Something went wrong whilst saving the gateway":"","Something went wrong whilst performing the requested operation":"","There are five different types of gateways supported by the SMS service. SMSes can be sent if at least one of the gateway types has been configured. If more than one gateway has been configured they will all be used in a round-robin fashion for load balancing":"","Delete selected":"","No gateways found":"","It looks like there aren\'t any configured gateways, or they couldn\'t be loaded.":"","Overview: SMS Configuration":"","Configure settings for SMS sending, receiving, data reporting, alerts, registration and more.":"","Gateway Configuration":"","Add and manage gateways for sending and receiving SMS messages in DHIS2.":"","Set up gateways":"","SMS Commands":"","Add and manage commands triggered by incoming SMS messages to register, alert and more.":"","Set up SMS commands":"","Sent SMS messages":"","Open logs of all SMS messages sent from DHIS2.":"","View all sent SMS":"","Received SMS messages":"","Open logs of all SMS messages received by DHIS2.":"","View all received SMS":"","Filter by status":"","Filter by phone number":"","Filter":"","Show":"","per page":"","Viewing {{firstItem}}-{{lastItem}} of {{total}}":"","Previous":"","Page":"","of {{pageCount}}":"","Next":"","Something went wrong whilst loading received SMSes":"","Message":"","Phone number":"","Status":"","Sender":"","Date":"","No SMSes to display":"","Unknown":"","Received":"","All":"","Failed":"","Incoming":"","Processed":"","Processing":"","Sent":"","Unhandled":"","Something went wrong whilst loading sent SMSes":"","Recipients":"","Delivered":"","Error":"","Outbound":"","Pending":"","Scheduled":"","Something went wrong whilst loading commands":"","Edit command":"","Unrecognised parser type":"","Could not find the requested parser type":"","Add command":"","Commands":"","Sms command":"","No commands to display":""}')},192:function(e,a,t){e.exports={headline:"PageHeadline_headline__1llN5"}},193:function(e,a,t){e.exports={explanation:"Home_explanation__10no3",cardTitle:"Home_cardTitle__3gL7c",cardText:"Home_cardText__1ODXu",cardLinkWrapper:"Home_cardLinkWrapper__ZU7rA",cardLink:"Home_cardLink__3qiDf",grid:"Home_grid__31J-5",gridItem:"Home_gridItem__1gOsm"}},199:function(e,a,t){e.exports={formRow:"FormRow_formRow__3ALDU"}},200:function(e,a,t){e.exports={textInputs:"GatewayKeyValuePair_textInputs__dJAb3",keyInput:"GatewayKeyValuePair_keyInput__2WHV_",valueInput:"GatewayKeyValuePair_valueInput__1uRVv",checkboxGroup:"GatewayKeyValuePair_checkboxGroup__2k2Cu",checkbox:"GatewayKeyValuePair_checkbox__2hg0g"}},201:function(e,a,t){e.exports={container:"GatewayList_container__jCYee",processingMessage:"GatewayList_processingMessage__1RE2H",loadingContainer:"GatewayList_loadingContainer__7veW4"}},202:function(e,a,t){e.exports={container:"ListActions_container__2mPW8"}},203:function(e,a,t){e.exports={container:"GatewayConfigList_container__3BZQo",actions:"GatewayConfigList_actions__yMRge"}},204:function(e,a,t){e.exports={container:"Filter_container__zWNRg",inputStrip:"Filter_inputStrip__28I4q"}},205:function(e,a,t){e.exports={container:"Pagination_container__1oOhc",verticalAlign:"Pagination_verticalAlign__2xbtG",select:"Pagination_select__39auA",buttonPrevious:"Pagination_buttonPrevious__SXF81",buttonNext:"Pagination_buttonNext__1HLDE",summary:"Pagination_summary__2dp6R"}},206:function(e,a,t){e.exports={noResults:"SmsTable_noResults__1t04p"}},207:function(e,a,t){e.exports={topBar:"ReceivedSmsList_topBar__2qRs6"}},208:function(e,a,t){e.exports={container:"FieldDataElementWithCategoryOptionCombo_container__2h1m8",field:"FieldDataElementWithCategoryOptionCombo_field__mnPuJ"}},209:function(e,a,t){e.exports={formRow:"DataElementTimesCategoryOptionCombos_formRow__TGwSL"}},210:function(e,a,t){e.exports={container:"FieldCommandSpecialCharacter_container__2Vgvs",field:"FieldCommandSpecialCharacter_field__-1mZE",button:"FieldCommandSpecialCharacter_button__2XK2-"}},211:function(e,a,t){e.exports={editButtonCell:"SmsCommandList_editButtonCell__1OBCC",checkbox:"SmsCommandList_checkbox__1mJm5",noResults:"SmsCommandList_noResults__j0ImP"}},212:function(e,a,t){e.exports={container:"Pagination_container__2LAE2",left:"Pagination_left__1ff2z",right:"Pagination_right__2Py4F",amount:"Pagination_amount__19_-8",pageselection:"Pagination_pageselection__27-Pj"}},213:function(e,a,t){e.exports={noResults:"SmsTable_noResults__rTkg-"}},214:function(e,a,t){e.exports={header:"SentSmsList_header__3biA5",headerRight:"SentSmsList_headerRight__XinlM"}},218:function(e,a,t){"use strict";t.r(a);var n={};t.r(n),t.d(n,"ALL_DATAVALUE",(function(){return Ra})),t.d(n,"AT_LEAST_ONE_DATAVALUE",(function(){return ja})),t.d(n,"DO_NOT_MARK_COMPLETE",(function(){return Ia}));var l={};t.r(l),t.d(l,"KEY_VALUE_PARSER",(function(){return Et})),t.d(l,"J2ME_PARSER",(function(){return pt})),t.d(l,"ALERT_PARSER",(function(){return bt})),t.d(l,"UNREGISTERED_PARSER",(function(){return ft})),t.d(l,"TRACKED_ENTITY_REGISTRATION_PARSER",(function(){return yt})),t.d(l,"PROGRAM_STAGE_DATAENTRY_PARSER",(function(){return vt})),t.d(l,"EVENT_REGISTRATION_PARSER",(function(){return ht}));var r={};t.r(r),t.d(r,"CommandsAddSpecialCharacters",(function(){return ka})),t.d(r,"ALL_DATAVALUE",(function(){return Ra})),t.d(r,"AT_LEAST_ONE_DATAVALUE",(function(){return ja})),t.d(r,"DO_NOT_MARK_COMPLETE",(function(){return Ia})),t.d(r,"DataElementTimesCategoryOptionCombos",(function(){return et})),t.d(r,"FieldCommandCompletenessMethod",(function(){return nt})),t.d(r,"FieldCommandConfirmMessage",(function(){return rt})),t.d(r,"FieldCommandDefaultMessage",(function(){return ot})),t.d(r,"FieldCommandMoreThanOneOrgUnitMessage",(function(){return mt})),t.d(r,"FieldCommandName",(function(){return dt})),t.d(r,"FieldCommandNoUserMessage",(function(){return gt})),t.d(r,"FieldCommandParser",(function(){return Ct})),t.d(r,"FieldCommandSeparator",(function(){return Ot})),t.d(r,"FieldCommandSmsCode",(function(){return Mt})),t.d(r,"FieldCommandSpecialCharacter",(function(){return Dt})),t.d(r,"FieldCommandSuccessMessage",(function(){return Pt})),t.d(r,"FieldCommandUseCurrentPeriodForReporting",(function(){return Lt})),t.d(r,"FieldCommandWrongFormatMessage",(function(){return qt})),t.d(r,"FieldDataElementWithCategoryOptionCombo",(function(){return Xa})),t.d(r,"FieldDataElementWithCategoryOptionComboFormula",(function(){return Ja})),t.d(r,"FIELD_COMMAND_COMPLETENESS_METHOD_NAME",(function(){return ga})),t.d(r,"FIELD_COMMAND_DEFAULT_MESSAGE_NAME",(function(){return Ea})),t.d(r,"FIELD_COMMAND_ID_NAME",(function(){return pa})),t.d(r,"FIELD_COMMAND_MORE_THAN_ONE_ORG_UNIT_MESSAGE_NAME",(function(){return ba})),t.d(r,"FIELD_COMMAND_NAME_NAME",(function(){return fa})),t.d(r,"FIELD_COMMAND_NO_USER_MESSAGE_NAME",(function(){return ya})),t.d(r,"FIELD_COMMAND_PARSER_NAME",(function(){return va})),t.d(r,"FIELD_COMMAND_PROGAM_NAME",(function(){return ha})),t.d(r,"FIELD_COMMAND_PROGAM_STAGE_NAME",(function(){return Sa})),t.d(r,"FIELD_COMMAND_SEPARATOR_NAME",(function(){return wa})),t.d(r,"FIELD_COMMAND_SMS_CODES_NAME",(function(){return Ca})),t.d(r,"FIELD_COMMAND_SPECIAL_CHARS_NAME",(function(){return _a})),t.d(r,"FIELD_COMMAND_SUCCESS_MESSAGE_NAME",(function(){return Oa})),t.d(r,"FIELD_COMMAND_USE_CURRENT_PERIOD_FOR_REPORTING_NAME",(function(){return Aa})),t.d(r,"FIELD_COMMAND_WRONG_FORMAT_MESSAGE_NAME",(function(){return Na})),t.d(r,"FIELD_COMMAND_CONFIRM_MESSAGE_NAME",(function(){return Ta})),t.d(r,"KEY_VALUE_PARSER",(function(){return Et})),t.d(r,"J2ME_PARSER",(function(){return pt})),t.d(r,"ALERT_PARSER",(function(){return bt})),t.d(r,"UNREGISTERED_PARSER",(function(){return ft})),t.d(r,"TRACKED_ENTITY_REGISTRATION_PARSER",(function(){return yt})),t.d(r,"PROGRAM_STAGE_DATAENTRY_PARSER",(function(){return vt})),t.d(r,"EVENT_REGISTRATION_PARSER",(function(){return ht})),t.d(r,"ProgramStageDataElements",(function(){return Vt}));var s=t(175),o=t(174),c=t(173),m=t(1),i=t.n(m),d=t(190),u=t.n(d);const g=Object(m.createContext)({addAlert:()=>{throw new Error("AlertContext has not been initialized yet!")}}),E=(e,a="dhis2-smsconfiguration")=>"".concat(a,"-").concat(e),p=({children:e})=>{const[a,t]=Object(m.useState)([]);return i.a.createElement(g.Provider,{value:{addAlert:e=>t([...a,e])}},e,i.a.createElement(c.b,{dataTest:E("notifications-alerthandler")},a.map(({message:e,type:a})=>i.a.createElement(c.a,Object.assign({dataTest:E("notifications-alert"),key:e},{[a]:!0}),e))))},b=()=>i.a.createElement("div",{"data-test":E("views-nomatch")},i.a.createElement("h1",null,"404"));var f=t(7),y=t.n(f),v=t(191);y.a.addResources("en","default",v);var h=y.a,S=t(192),w=t.n(S);const C=({children:e})=>i.a.createElement("h1",{className:w.a.headline,"data-test":E("headline-pageheadline")},e);var _=t(193),O=t.n(_);const A=()=>i.a.createElement("div",{"data-test":E("views-home")},i.a.createElement(C,null,h.t("Overview: SMS Configuration",{nsSeparator:">"})),i.a.createElement("p",{className:O.a.explanation},h.t("Configure settings for SMS sending, receiving, data reporting, alerts, registration and more.")),i.a.createElement("div",{className:O.a.grid},i.a.createElement("div",{className:O.a.gridItem},i.a.createElement(c.e,null,i.a.createElement("h2",{className:O.a.cardTitle},h.t("Gateway Configuration")),i.a.createElement("p",{className:O.a.cardText},h.t("Add and manage gateways for sending and receiving SMS messages in DHIS2.")),i.a.createElement("div",{className:O.a.cardLinkWrapper},i.a.createElement(s.b,{className:O.a.cardLink,to:xe},h.t("Set up gateways"))))),i.a.createElement("div",{className:O.a.gridItem},i.a.createElement(c.e,null,i.a.createElement("h2",{className:O.a.cardTitle},h.t("SMS Commands")),i.a.createElement("p",{className:O.a.cardText},h.t("Add and manage commands triggered by incoming SMS messages to register, alert and more.")),i.a.createElement("div",{className:O.a.cardLinkWrapper},i.a.createElement(s.b,{className:O.a.cardLink,to:tl},h.t("Set up SMS commands"))))),i.a.createElement("div",{className:O.a.gridItem},i.a.createElement(c.e,null,i.a.createElement("h2",{className:O.a.cardTitle},h.t("Sent SMS messages")),i.a.createElement("p",{className:O.a.cardText},h.t("Open logs of all SMS messages sent from DHIS2.")),i.a.createElement("div",{className:O.a.cardLinkWrapper},i.a.createElement(s.b,{className:O.a.cardLink,to:Ol},h.t("View all sent SMS"))))),i.a.createElement("div",{className:O.a.gridItem},i.a.createElement(c.e,null,i.a.createElement("h2",{className:O.a.cardTitle},h.t("Received SMS messages")),i.a.createElement("p",{className:O.a.cardText},h.t("Open logs of all SMS messages received by DHIS2.")),i.a.createElement("div",{className:O.a.cardLinkWrapper},i.a.createElement(s.b,{className:O.a.cardLink,to:Ue},h.t("View all received SMS"))))))),N=({onCancelClick:e,onDeleteClick:a})=>i.a.createElement(c.p,{dataTest:E("gateways-deleteconfirmationdialog")},i.a.createElement(c.s,null,h.t("Confirm deletion")),i.a.createElement(c.r,null,h.t("Are you sure you want to delete the selected gateways?")),i.a.createElement(c.q,null,i.a.createElement(c.d,null,i.a.createElement(c.c,{secondary:!0,onClick:e,dataTest:E("gateways-deleteconfirmationdialog-cancel")},"Cancel"),i.a.createElement(c.c,{destructive:!0,onClick:a,dataTest:E("gateways-deleteconfirmationdialog-confirm")},"Delete")))),{Field:T}=c.u,M=()=>i.a.createElement(T,{required:!0,dataTest:E("gateways-fieldgatewayauthtoken"),name:"authtoken",label:h.t("Auth token"),component:c.m,validate:Object(c.I)(c.K,c.J)}),{Field:k}=c.u,R=()=>i.a.createElement(k,{required:!0,dataTest:E("gateways-fieldgatewayname"),name:"name",label:h.t("Name"),component:c.m,validate:Object(c.I)(c.K,c.J)}),{Field:j}=c.u,I=()=>i.a.createElement(j,{required:!0,dataTest:E("gateways-fieldgatewaypassword"),name:"password",label:h.t("Password"),component:c.m,validate:Object(c.I)(c.K,c.J)}),{Field:D}=c.u,F=()=>i.a.createElement(D,{required:!0,dataTest:E("gateways-fieldgatewayurltemplate"),name:"urlTemplate",label:h.t("Url template"),component:c.m,validate:Object(c.I)(c.L,c.J)}),{Field:P}=c.u,x=()=>i.a.createElement(P,{required:!0,dataTest:E("gateways-fieldgatewayusername"),name:"username",label:h.t("User name"),component:c.m,validate:Object(c.I)(c.K,c.J)}),{useForm:L}=c.u,G=()=>{const{change:e,getState:a}=L();return i.a.createElement(c.c,{onClick:()=>{const{parameters:t}=a().values;e("parameters",[...t,{header:!1,encode:!1,key:"",value:"",confidential:!1}])},dataTest:E("gateways-gatewayaddkeyvaluepair")},h.t("Add key value pair"))};var q=t(6),U=t.n(q),V=t(199),B=t.n(V);const H=({children:e,className:a})=>i.a.createElement("div",{className:U()(B.a.formRow,a),"data-test":E("forms-formrow")},e),{Form:z}=c.u,J=({onSubmit:e,initialValues:a})=>{const t=a?h.t("Save gateway"):h.t("Add gateway");return i.a.createElement(z,{onSubmit:e,initialValues:a},({handleSubmit:e,submitting:a})=>i.a.createElement("form",{onSubmit:e,"data-test":E("gateways-gatewaybulksmsform")},i.a.createElement(H,null,i.a.createElement(R,null)),i.a.createElement(H,null,i.a.createElement(x,null)),i.a.createElement(H,null,i.a.createElement(I,null)),i.a.createElement(c.c,{primary:!0,type:"submit",icon:a?i.a.createElement(c.i,{small:!0}):null,disabled:a,dataTest:E("forms-gatewaybulksmsform-submit")},t)))};J.defaultProps={initialValues:{}};const{Form:W}=c.u,K=({onSubmit:e,initialValues:a})=>{const t=a?h.t("Save gateway"):h.t("Add gateway");return i.a.createElement(W,{onSubmit:e,initialValues:a},({handleSubmit:e,submitting:a})=>i.a.createElement("form",{onSubmit:e,"data-test":E("gateways-gatewayclickatellform")},i.a.createElement(H,null,i.a.createElement(R,null)),i.a.createElement(H,null,i.a.createElement(x,null)),i.a.createElement(H,null,i.a.createElement(M,null)),i.a.createElement(H,null,i.a.createElement(F,null)),i.a.createElement(c.c,{primary:!0,type:"submit",icon:a?i.a.createElement(c.i,{small:!0}):null,disabled:a,dataTest:E("forms-gatewayclickatellform-submit")},t)))};K.defaultProps={initialValues:{}};const{Form:Y}=c.u,X=({onSubmit:e,initialValues:a})=>{const t=a?h.t("Save gateway"):h.t("Add gateway");return i.a.createElement(Y,{onSubmit:e,initialValues:a},({handleSubmit:e,values:a,submitting:n})=>i.a.createElement("form",{onSubmit:e,"data-test":E("gateways-gatewaygenericform")},i.a.createElement(H,null,i.a.createElement(R,null)),i.a.createElement(H,null,i.a.createElement(F,null)),a.parameters.map((e,a)=>i.a.createElement(te,{index:a,key:a})),i.a.createElement(H,null,i.a.createElement(c.t,null,h.t("With a generic http gateway any number of parameters can be added with key value pairs"))),i.a.createElement(H,null,i.a.createElement(G,null)),i.a.createElement(c.c,{primary:!0,type:"submit",dataTest:E("forms-gatewaygenericform-submit"),disabled:n,icon:n?i.a.createElement(c.i,{small:!0}):null},t)))};X.defaultProps={initialValues:{parameters:[]}};var Z=t(200),Q=t.n(Z);const{Field:$,useForm:ee}=c.u,ae=Object(c.I)(c.K,c.J),te=({index:e})=>{const{change:a,getState:t}=ee();return i.a.createElement("div",{"data-test":E("gateways-gatewaykeyvaluepair")},i.a.createElement(H,null,i.a.createElement("div",{className:Q.a.textInputs},i.a.createElement($,{dataTest:E("gateways-gatewaykeyvaluepair-key"),className:Q.a.keyInput,name:"parameters[".concat(e,"].key"),label:h.t("Key"),component:c.m,validate:ae}),i.a.createElement($,{dataTest:E("gateways-gatewaykeyvaluepair-value"),className:Q.a.valueInput,name:"parameters[".concat(e,"].value"),label:h.t("Value"),component:c.m,validate:ae})),i.a.createElement("div",{className:Q.a.checkboxGroup},i.a.createElement($,{dataTest:E("gateways-gatewaykeyvaluepair-isheader"),className:Q.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].header"),label:h.t("Send as header"),component:c.h}),i.a.createElement($,{dataTest:E("gateways-gatewaykeyvaluepair-isencoded"),className:Q.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].encode"),label:h.t("Encode"),component:c.h}),i.a.createElement($,{dataTest:E("gateways-gatewaykeyvaluepair-isconfidential"),className:Q.a.checkbox,type:"checkbox",name:"parameters[".concat(e,"].confidential"),label:h.t("Confidential"),component:c.h})),i.a.createElement(c.c,{dataTest:E("gateways-gatewaykeyvaluepair-remove"),onClick:()=>(e=>{const{parameters:n}=t().values;a("parameters",0===e?n.slice(1):[...n.slice(0,e),...n.slice(e+1)])})(e)},h.t("Remove key value pair"))))};var ne=t(11);const le="".concat("/sms-gateway/edit","/:id"),re=()=>{var e;const a=Object(o.f)(),{id:t}=Object(o.h)(),{loading:n,error:l,data:r}=he(t),[s,{error:m}]=ke(),[d,{error:u}]=Ae(),[g,{error:p}]=Te(),b=m||u||p;if(n)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,h.t("Edit")),i.a.createElement(c.f,null,i.a.createElement(c.i,null)));if(l){const e=h.t("Something went wrong whilst loading gateways");return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,h.t("Edit")),i.a.createElement(c.t,{error:!0,title:e},l.message))}const f=r&&"string"===typeof r.gateway?{gateway:JSON.parse(r.gateway)}:r,y=null===f||void 0===f||null===(e=f.gateway)||void 0===e?void 0:e.type,v=async e=>{const t=Object(ne.a)(Object(ne.a)({},e),{},{id:f.gateway.uid});try{t.type===ie&&await s(t),t.type===de&&await d(t),t.type===ue&&await g(t),a.push(xe)}catch(n){return Promise.reject(n)}},S=null===f||void 0===f?void 0:f.gateway;return i.a.createElement("div",{"data-test":E("views-gatewayconfigformedit")},i.a.createElement(C,null,h.t("Edit gateway")),S?i.a.createElement("div",{"data-test":E("views-gatewayconfigformedit-formcontainer"),"data-gateway-id":f.gateway.uid},b&&i.a.createElement(c.t,{error:!0,title:h.t("Something went wrong whilst saving gateways")},b.message),y===ie&&i.a.createElement(X,{initialValues:f.gateway,onSubmit:v}),y===de&&i.a.createElement(J,{initialValues:f.gateway,onSubmit:v}),y===ue&&i.a.createElement(K,{initialValues:f.gateway,onSubmit:v})):i.a.createElement(c.t,{error:!0,title:h.t("Gateway not found")},h.t("The requested gateway could not be loaded")))},se=({allGatewaysChecked:e,checkedGateways:a,gateways:t,onGatewayToggle:n,onToggleAll:l,onMakeDefaultClick:r})=>{const s=Object(o.f)();return i.a.createElement(c.z,{dataTest:E("gateways-gatewaystable")},i.a.createElement(c.E,null,i.a.createElement(c.G,null,i.a.createElement(c.C,{dataTest:E("gateways-gatewaystable-checkall")},i.a.createElement(c.g,{onChange:l,checked:e})),i.a.createElement(c.C,null,h.t("Name")),i.a.createElement(c.C,null,h.t("Type")),i.a.createElement(c.C,null,h.t("Default gateway")),i.a.createElement(c.C,null))),i.a.createElement(c.A,null,t.map(e=>{return i.a.createElement(c.F,{key:e.uid,dataTest:E("gateways-gatewaystable-row")},i.a.createElement(c.B,{dataTest:E("gateways-gatewaystable-checkbox")},i.a.createElement(c.g,{value:e.uid,onChange:()=>n(e.uid),checked:a.includes(e.uid),dataTest:E("gateways-gatewaystable-id")})),i.a.createElement(c.B,{dataTest:E("gateways-gatewaystable-name")},e.name),i.a.createElement(c.B,{dataTest:E("gateways-gatewaystable-type")},"bulksms"===(t=e.type)?h.t("BulkSMS"):"clickatell"===t?h.t("Clickatell"):"http"!==t&&t?t:h.t("Generic")),i.a.createElement(c.B,{dataTest:E("gateways-gatewaystable-isdefault")},e.isDefault?h.t("Yes"):h.t("No")),i.a.createElement(c.B,{dataTest:E("gateways-gatewaystable-actions")},i.a.createElement(c.d,null,!e.isDefault&&i.a.createElement(c.c,{dataTest:E("gateways-gatewaystable-makedefault"),onClick:()=>r(e.uid)},h.t("Make default")),i.a.createElement(c.c,{dataTest:E("gateways-gatewaystable-edit"),onClick:()=>{s.push("".concat("/sms-gateway/edit","/").concat(e.uid))}},h.t("Edit")))));var t})))};var oe=t(201),ce=t.n(oe);const me=({checkedGateways:e,gateways:a,setCheckedGateways:t,onMakeDefaultClick:n,processing:l})=>{const r=e.length===a.length;return i.a.createElement("div",{className:ce.a.container,"data-test":E("gateways-gatewaylist")},l&&i.a.createElement("div",{className:ce.a.processingMessage},i.a.createElement("div",{className:ce.a.loadingContainer},i.a.createElement(c.i,null))),i.a.createElement(se,{allGatewaysChecked:r,gateways:a,checkedGateways:e,onGatewayToggle:a=>{if(e.includes(a)){const n=e.findIndex(e=>e===a),l=0===n?e.slice(1):[...e.slice(0,n),...e.slice(n+1)];t(l)}else t([...e,a])},onMakeDefaultClick:n,onToggleAll:()=>{if(r)t([]);else{const e=a.map(({uid:e})=>e);t(e)}}}))},ie="http",de="bulksms",ue="clickatell";var ge=t(8);const Ee={resource:"gateways",type:"create",data:({name:e,username:a,password:t})=>({type:"bulksms",name:e,username:a,password:t})},pe={resource:"gateways",type:"create",data:({name:e,username:a,authtoken:t,urlTemplate:n})=>({type:"clickatell",name:e,username:a,authtoken:t,urlTemplate:n})},be={resource:"gateways",type:"create",data:({name:e,urlTemplate:a,parameters:t})=>({type:"http",name:e,urlTemplate:a,parameters:t})},fe={resource:"gateways",type:"delete",id:({id:e})=>e},ye=()=>{const[e,a]=Object(m.useState)(!1),[t,n]=Object(m.useState)(null),l=(e=>a=>{const t={id:a};return e.mutate(fe,{variables:t})})(Object(ge.c)()),r=e=>(a(!1),e),s=e=>{n(e),a(!1)};return[({ids:e})=>(a(!0),Promise.all(e.map(l)).then(r).catch(s)),{loading:e,error:t}]},ve={gateway:{resource:"gateways",id:({id:e})=>e}},he=e=>Object(ge.e)(ve,{variables:{id:e}});var Se=t(178);const we={gateways:{resource:"gateways.json",params:({fields:e,filter:a})=>{const t={};return e&&(t.fields=e),a&&(t.filter=a),t}}},Ce={resource:"gateways/default",type:"replace",id:({id:e})=>e},_e=e=>{const[a,t]=Object(m.useState)(!1),[n,l]=Object(m.useState)(null),r=Object(ge.c)();return[a=>{const n=Object(ne.a)(Object(ne.a)({},e),{},{id:a.id});return t(!0),l(null),r.mutate(n,{variables:a}).then(e=>(t(!1),e)).catch(e=>{throw t(!1),l(e),e})},{loading:a,error:n}]},Oe={resource:"gateways",id:({id:e})=>e,type:"update",data:({name:e,username:a,password:t})=>({type:"bulksms",name:e,username:a,password:t})},Ae=()=>_e(Oe),Ne={resource:"gateways",id:({id:e})=>e,type:"update",data:({name:e,username:a,authtoken:t,urlTemplate:n})=>({type:"clickatell",name:e,username:a,authtoken:t,urlTemplate:n})},Te=()=>_e(Ne),Me={resource:"gateways",id:({id:e})=>e,type:"replace",data:({name:e,urlTemplate:a,parameters:t})=>({type:"http",name:e,urlTemplate:a,parameters:t})},ke=()=>_e(Me),Re=()=>{const e=Object(o.f)(),[a,t]=Object(m.useState)(ie),[n,{error:l}]=Object(ge.d)(be),[r,{error:s}]=Object(ge.d)(Ee),[d,{error:u}]=Object(ge.d)(pe),g=l||s||u;if(g){const e=h.t("Something went wrong whilst saving the gateway");return i.a.createElement("div",{"data-test":E("views-gatewayconfigformnew")},i.a.createElement(C,null,h.t("Add gateway")),i.a.createElement(c.t,{error:!0,title:e},g.message))}const p=async t=>{try{a===ie&&await n(t),a===de&&await r(t),a===ue&&await d(t),e.push(xe)}catch(l){return Promise.reject(l)}};return i.a.createElement("div",{"data-test":E("views-gatewayconfigformnew")},i.a.createElement(C,null,h.t("Add gateway")),i.a.createElement(H,null,i.a.createElement(c.w,{label:h.t("Type"),onChange:({selected:e})=>t(e),selected:a,dataTest:E("views-gatewayconfigformnew-gatewaytype")},i.a.createElement(c.y,{value:ie,label:h.t("Generic")}),i.a.createElement(c.y,{value:de,label:h.t("BulkSMS")}),i.a.createElement(c.y,{value:ue,label:h.t("Clickatell")}))),i.a.createElement(H,null,a===ie&&i.a.createElement(X,{onSubmit:p}),a===de&&i.a.createElement(J,{onSubmit:p,passwordRequired:!0}),a===ue&&i.a.createElement(K,{onSubmit:p,passwordRequired:!0})))};var je=t(202),Ie=t.n(je);const De=({addLabel:e,deleteLabel:a,dataTest:t,onAddClick:n,onDeleteClick:l,disableAdd:r,disableDelete:s})=>i.a.createElement("div",{className:Ie.a.container},i.a.createElement(c.d,{"data-test":E("".concat(t,"-actions"))},i.a.createElement(c.c,{primary:!0,onClick:n,disabled:r,dataTest:E("".concat(t,"-add"))},e),i.a.createElement(c.c,{destructive:!0,onClick:l,disabled:s,dataTest:E("".concat(t,"-delete"))},a)));var Fe=t(203),Pe=t.n(Fe);const xe="/sms-gateway",Le=()=>{var e,a;const t=Object(o.f)(),[n,l]=Object(m.useState)([]),[r,s]=Object(m.useState)(!1),{loading:d,error:u,data:g,refetch:p}=(e=>{var a;"id:in:[".concat(null===e||void 0===e?void 0:e.join(","),"]");const t={},n=Object(ge.e)(we,{variables:t}),{data:l}=n,r=Object(Se.a)(n,["data"]),s=l&&"string"===typeof l.gateways?{gateways:JSON.parse(l.gateways)}:l,o=e&&(null===s||void 0===s||null===(a=s.gateways)||void 0===a?void 0:a.gateways)?{gateways:{gateways:s.gateways.gateways.filter(({uid:a})=>e.includes(a))}}:s;return Object(ne.a)({data:o},r)})(),[b,{loading:f,error:y}]=ye(),[v,{loading:S,error:w}]=Object(ge.d)(Ce),_=d||f||S;if(_)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,"Gateway configuration"),i.a.createElement(c.f,null,i.a.createElement(c.i,null)));const O=u||y||w;if(O){const e=h.t("Something went wrong whilst performing the requested operation");return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,"Gateway configuration"),i.a.createElement(c.t,{error:!0,title:e},O.message))}const A=!!(null===g||void 0===g||null===(e=g.gateways)||void 0===e||null===(a=e.gateways)||void 0===a?void 0:a.length);return i.a.createElement("div",{className:Pe.a.container,"data-test":E("views-gatewayconfiglist")},i.a.createElement(C,null,"Gateway configuration"),i.a.createElement("p",null,h.t("There are five different types of gateways supported by the SMS service. SMSes can be sent if at least one of the gateway types has been configured. If more than one gateway has been configured they will all be used in a round-robin fashion for load balancing")),i.a.createElement(De,{addLabel:h.t("Add gateway"),deleteLabel:h.t("Delete selected"),dataTest:"views-gatewayconfiglist",onAddClick:()=>t.push("/sms-gateway/new"),onDeleteClick:()=>s(!0),disableAdd:f,disableDelete:!n.length||f}),A?i.a.createElement(me,{processing:_,checkedGateways:n,setCheckedGateways:l,gateways:g.gateways.gateways,onMakeDefaultClick:e=>{v({id:e}).then(p)}}):i.a.createElement(c.t,{info:!0,title:h.t("No gateways found")},h.t("It looks like there aren't any configured gateways, or they couldn't be loaded.")),r&&i.a.createElement(N,{onCancelClick:()=>s(!1),onDeleteClick:()=>{b({ids:n}).then(p),s(!1)}}))};var Ge=t(9);const qe=y.a.t("Received"),Ue="/received",Ve=[{value:"ALL",label:y.a.t("All")},{value:"FAILED",label:y.a.t("Failed")},{value:"INCOMING",label:y.a.t("Incoming")},{value:"PROCESSED",label:y.a.t("Processed")},{value:"PROCESSING",label:y.a.t("Processing")},{value:"SENT",label:y.a.t("Sent")},{value:"UNHANDLED",label:y.a.t("Unhandled")}],Be=()=>{const e=new URLSearchParams(Object(o.g)().search);return{status:e.get("status")||"ALL",phoneNumber:e.get("phoneNumber")||"",page:parseInt(e.get("page")||1),pageSize:parseInt(e.get("pageSize")||50)}},He=e=>{const a=Object.keys(e).reduce((a,t)=>{const n=e[t];return n&&!("status"===t&&"ALL"===n)&&a.push("".concat(t,"=").concat(n)),a},[]).join("&");return"?".concat(a)};var ze=t(204),Je=t.n(ze);const{Form:We,Field:Ke}=c.u,Ye=({loading:e})=>{const{status:a,phoneNumber:t,pageSize:n}=Be(),l={status:a,phoneNumber:t},r=Object(o.f)();return i.a.createElement("div",{"data-test":E("views-receivedsms-filter"),className:Je.a.container},i.a.createElement(We,{onSubmit:({status:e,phoneNumber:a})=>{r.push({search:He({status:e,phoneNumber:a,pageSize:n,page:1})})},initialValues:l},({handleSubmit:a,pristine:t})=>i.a.createElement("form",{onSubmit:a,className:Je.a.inputStrip},i.a.createElement(Ke,{name:"status",component:c.x,options:Ve,label:y.a.t("Filter by status"),inputWidth:"200px"}),i.a.createElement(Ke,{name:"phoneNumber",component:c.m,label:y.a.t("Filter by phone number"),className:Je.a.phoneNumberField,inputWidth:"300px"}),i.a.createElement(c.c,{large:!0,type:"submit",disabled:e||t},y.a.t("Filter")))))},Xe={resource:"sms/inbound",type:"delete",params:({ids:e})=>({ids:e})},Ze=({selectedIds:e,onComplete:a})=>{const{addAlert:t}=Object(m.useContext)(g),[n]=Object(ge.d)(Xe,{onComplete:a,onError:e=>{t({type:"critical",message:e.message})}});return i.a.createElement(c.c,{destructive:!0,onClick:()=>n({ids:e.join()}),disabled:0===e.length},y.a.t("Delete selected"))};var Qe=t(15),$e=t.n(Qe),ea=t(205),aa=t.n(ea);const ta=["1","2","10","20","30","40","50","100"],na=({page:e,pageCount:a,pageSize:t,total:n})=>{const l=Math.min((e-1)*t+1,n),r=Math.min(l+t-1,n),s=Array.from({length:a},(e,a)=>(a+1).toString()),{status:m,phoneNumber:d}=Be(),u=Object(o.f)(),g=e=>{u.push({search:He({status:m,phoneNumber:d,pageSize:t,page:e})})};return i.a.createElement("div",{className:aa.a.container},i.a.createElement("div",{className:aa.a.verticalAlign},y.a.t("Show"),i.a.createElement(c.v,{dense:!0,selected:t.toString(),onChange:({selected:e})=>{u.push({search:He({status:m,phoneNumber:d,pageSize:e,page:1})})},className:aa.a.select},ta.map(e=>i.a.createElement(c.y,{key:e,value:e,label:e}))),y.a.t("per page")),i.a.createElement("div",{className:aa.a.verticalAlign},i.a.createElement("span",{className:aa.a.summary},y.a.t("Viewing {{firstItem}}-{{lastItem}} of {{total}}",{firstItem:l,lastItem:r,total:n})),i.a.createElement(c.c,{className:aa.a.buttonPrevious,small:!0,disabled:1===e,onClick:()=>g(e-1)},y.a.t("Previous")),i.a.createElement("span",null,y.a.t("Page")),i.a.createElement(c.v,{dense:!0,inputWidth:"600px",selected:e.toString(),onChange:({selected:e})=>g(e),className:aa.a.select},s.map(e=>i.a.createElement(c.y,{key:e,value:e,label:e}))),i.a.createElement("span",null,y.a.t("of {{pageCount}}",{pageCount:a})),i.a.createElement(c.c,{className:aa.a.buttonNext,small:!0,disabled:e===a,onClick:()=>g(e+1)},y.a.t("Next"))))};var la=t(206),ra=t.n(la);const sa={resource:"sms/inbound",id:({id:e})=>e,type:"delete"},oa=({id:e,onComplete:a})=>{const{addAlert:t}=Object(m.useContext)(g),[n,{loading:l,error:r}]=Object(ge.d)(sa,{onComplete:a,onError:e=>{t({type:"critical",message:e.message})},variables:{id:e}});return i.a.createElement(c.c,{small:!0,destructive:!0,onClick:n,disabled:l||r},y.a.t("Delete"))},ca=({messages:e,pager:a,refetchList:t,selectedIds:n,setSelectedIds:l})=>{const r=new Set(n),s=e.length>0&&n.length===e.length,o=e=>{r.has(e)?r.delete(e):r.add(e),l(Array.from(r))};return i.a.createElement(c.z,null,i.a.createElement(c.E,null,i.a.createElement(c.G,null,i.a.createElement(c.C,null,i.a.createElement(c.g,{checked:s,onChange:()=>{l(s?[]:e.map(({id:e})=>e))}})),i.a.createElement(c.C,null,y.a.t("Message")),i.a.createElement(c.C,null,y.a.t("Phone number")),i.a.createElement(c.C,null,y.a.t("Status")),i.a.createElement(c.C,null,y.a.t("Sender")),i.a.createElement(c.C,null,y.a.t("Date")),i.a.createElement(c.C,null,y.a.t("Delete")))),i.a.createElement(c.A,null,0===e.length?i.a.createElement(c.F,null,i.a.createElement(c.B,{colSpan:"7",className:ra.a.noResults},y.a.t("No SMSes to display"))):e.map(e=>i.a.createElement(c.F,{key:e.id},i.a.createElement(c.B,null,i.a.createElement(c.g,{checked:r.has(e.id),onChange:o.bind(null,e.id)})),i.a.createElement(c.B,null,e.text),i.a.createElement(c.B,null,e.originator),i.a.createElement(c.B,null,e.smsstatus),i.a.createElement(c.B,null,e.user?e.user.userCredentials.username:y.a.t("Unknown")),i.a.createElement(c.B,null,$e()(e.receivedDate).format("MMMM Do YYYY, h:mm:ss a")),i.a.createElement(c.B,null,i.a.createElement(oa,{destructive:!0,small:!0,onComplete:t,id:e.id},"Delete"))))),i.a.createElement(c.D,null,i.a.createElement(c.F,null,i.a.createElement(c.B,{colSpan:"7"},i.a.createElement(na,a)))))};var ma=t(207),ia=t.n(ma);const da={inboundSms:{resource:"sms/inbound",params:({page:e,pageSize:a,phoneNumber:t,status:n})=>({page:e,pageSize:a,phoneNumber:t,status:n,fields:["id","text","originator","smsstatus","user[userCredentials[username]]","receiveddate"]})}},ua=()=>{var e;const[a,t]=Object(m.useState)([]),{page:n,pageSize:l,phoneNumber:r,status:s}=Be(),{called:o,loading:d,error:u,data:g,refetch:p}=Object(Ge.d)(da,{lazy:!0});if(Object(m.useEffect)(()=>{p({page:n,pageSize:l,phoneNumber:r,status:s})},[n,l,r,s]),d||!o)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,qe),i.a.createElement(c.f,null,i.a.createElement(c.i,null)));if(u){const e=h.t("Something went wrong whilst loading received SMSes");return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,qe),i.a.createElement(c.t,{error:!0,title:e},u.message))}const b=(null===g||void 0===g||null===(e=g.inboundSms)||void 0===e?void 0:e.inboundsmss)||[];return i.a.createElement("div",{"data-test":E("views-receivedsmslist")},i.a.createElement(C,null,qe),i.a.createElement("div",{className:ia.a.topBar},i.a.createElement(Ye,{loading:d}),i.a.createElement(Ze,{onComplete:()=>{p(),t([])},selectedIds:a})),i.a.createElement("div",null,i.a.createElement(ca,{messages:b,pager:g.inboundSms.pager,selectedIds:a,setSelectedIds:t,refetchList:p})))},ga="completenessMethod",Ea="defaultMessage",pa="id",ba="moreThanOneOrgUnitMessage",fa="name",ya="noUserMessage",va="parserType",ha="program",Sa="programStage",wa="separator",Ca="smsCodes",_a="specialCharacters",Oa="successMessage",Aa="currentPeriodUsedForReporting",Na="wrongFormatMessage",Ta="receivedMessage",{useForm:Ma}=c.u,ka=()=>{const{change:e,getState:a}=Ma();return i.a.createElement(H,null,i.a.createElement(c.c,{onClick:()=>{const t=[...a().values[_a],{name:"",value:""}];e(_a,t)},dataTest:E("forms-commandsaddspecialcharacters")},h.t("Add special character")))},Ra={value:"ALL_DATAVALUE",label:h.t("Receive all data value")},ja={value:"AT_LEAST_ONE_DATAVALUE",label:h.t("Receive at least one data value")},Ia={value:"DO_NOT_MARK_COMPLETE",label:h.t("Do not mark as complete")},{Field:Da}=c.u,Fa=({dataSets:e,loading:a,required:t,disabled:n,errorText:l})=>i.a.createElement(Da,{disabled:n,error:!!l,validationText:l,required:t,loading:a,dataTest:E("forms-fielddataset"),name:"dataset",label:h.t("Dataset"),component:c.x,options:e,validate:c.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});Fa.defaultProps={disabled:!1,loading:!1,required:!1,errorText:""};const Pa={dataSets:{resource:"dataSets",params:{fields:["id","displayName"],paging:"false"}}},xa=({required:e})=>{const{loading:a,error:t,data:n}=Object(ge.e)(Pa);if(a)return i.a.createElement(Fa,{loading:!0,showLoadingStatus:!0,required:e,dataSets:[]});if(t)return i.a.createElement(Fa,{required:e,disabled:!0,programs:[],errorText:t.message});const{dataSets:l}=n.dataSets,r=l.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(Fa,{required:e,dataSets:r})};xa.defaultProps={required:!1};const La={dataSet:{resource:"dataSets",id:({id:e})=>e,params:({fields:e=["id","displayName"]}={})=>({fields:e})}},Ga={dataElements:{resource:"dataElements",params:({ids:e})=>({filter:"id:in:[".concat(e.join(","),"]"),fields:"id,code,displayName,categoryCombo",paging:"false"})}},qa=(e,a)=>e.query(Ga,{variables:a}).then(e=>Object(ne.a)(Object(ne.a)({},e),{},{dataElements:Object(ne.a)(Object(ne.a)({},e.dataElements),{},{dataElements:e.dataElements.dataElements.map(e=>{let{code:a}=e,t=Object(Se.a)(e,["code"]);return Object(ne.a)(Object(ne.a)({},t),{},{code:a.replace("DE_","")})})})})),Ua=(e,a)=>{const t=Object(ne.a)(Object(ne.a)({},a),{},{fields:"dataSetElements"});return((e,a)=>e.query(La,{variables:a}))(e,t).then(e=>{const a=e.dataSet,{dataSetElements:t}=a;return t.map(({dataElement:e})=>e.id)}).then(a=>{if(!a.length)return[];return qa(e,{ids:a})})},{Field:Va,Form:Ba,useForm:Ha,useFormState:za}=c.u,Ja=({targetFieldName:e,onClose:a})=>{const t=Ha(),{values:n}=za(),{id:l}=n.dataset,{loading:r,error:s,data:o}=(e=>{const[a,t]=Object(m.useState)(!0),[n,l]=Object(m.useState)(null),[r,s]=Object(m.useState)(null),o=Object(ge.c)(),c=e=>(t(!0),l(null),Ua(o,e).then(s).catch(l).finally(()=>t(!1)));return Object(m.useEffect)(()=>{c({id:e})},[]),{loading:a,error:n,data:r,refetch:c}})(l),d=((e,a)=>{let t=null;const n=e.split(".");if(!(a instanceof Object))return t;for(let l=0,r=a;l<n.length;++l){const e=r[n[l]];if(!e)break;if(l===n.length-1){t=e;break}r=e}return t})(e,n),u={operator:Object(m.useMemo)(()=>d?d[0]:"+",[]),dataElementCode:Object(m.useMemo)(()=>d?d.slice(1):"",[])};if(r)return i.a.createElement(c.p,null,i.a.createElement(c.i,null));const g=o.dataElements.dataElements.map(e=>{const{code:a,displayName:t}=e;return{value:a,label:t}}),E=()=>{t.change(e,null),a()};return i.a.createElement(Ba,{onSubmit:n=>{const l="".concat(n.operator).concat(n.dataElementCode);t.change(e,l),a()},initialValues:u},({handleSubmit:e})=>i.a.createElement(c.p,null,i.a.createElement(c.s,null,h.t("")),i.a.createElement(c.r,null,i.a.createElement("form",{onSubmit:a=>{a.stopPropagation(),e(a)}},i.a.createElement(H,null,i.a.createElement(Va,{required:!0,name:"dataElementCode",label:h.t("Data element"),component:c.x,options:g,validate:c.J})),i.a.createElement(H,null,i.a.createElement(Va,{required:!0,name:"operator",label:h.t("formula operator"),component:c.x,initialValue:"+",options:[{value:"+",label:"+"},{value:"-",label:"-"}]})),s&&i.a.createElement(H,null,i.a.createElement(c.t,{error:!0,title:h.t("Something went wrong whilst saving")},s.message)),i.a.createElement(H,null,i.a.createElement(c.d,null,i.a.createElement(c.c,{type:"submit",primary:!0},h.t("Save")),i.a.createElement(c.c,{onClick:a},h.t("Cancel")),i.a.createElement(c.c,{onClick:E},h.t("Remove"))))))))};var Wa=t(208),Ka=t.n(Wa);const{Field:Ya}=c.u,Xa=({dataElement:e,categoryOptionCombo:a})=>{const[t,n]=Object(m.useState)(!1),l=a?"".concat(e.displayName," ").concat(a.displayName):"".concat(e.displayName," ").concat(h.t("default")),r=Bt(e,a),s="".concat(r,".code"),o="".concat(r,".formula");return i.a.createElement("div",{className:Ka.a.container},i.a.createElement(Ya,{className:Ka.a.field,label:l,name:s,subscription:{value:!0,error:!0,invalid:!0,touched:!0}},e=>{let{input:a,meta:l}=e,r=Object(Se.a)(e,["input","meta"]);const s=a.value;return i.a.createElement(i.a.Fragment,null,i.a.createElement(H,null,i.a.createElement(c.m,Object.assign({},r,{input:a,meta:l,error:!!l.error}))),s&&i.a.createElement(i.a.Fragment,null,i.a.createElement(c.c,{onClick:()=>n(!0)},h.t("Change formula")),t&&i.a.createElement(Ja,{targetFieldName:o,onClose:()=>n(!1)})))}))};Xa.defaultProps={categoryOptionCombo:null,formula:""};var Za=t(209),Qa=t.n(Za);const{FormSpy:$a}=c.u,et=({DE_COC_combinations:e})=>i.a.createElement("div",null,i.a.createElement("h2",null,h.t("Data element category combination")),i.a.createElement($a,{subscription:{errors:!0,pristine:!0}},({errors:e,pristine:a})=>{if(a)return i.a.createElement("span",null);const t=e[Ca],n=null===t||void 0===t?void 0:t.global;return i.a.createElement(i.a.Fragment,null,n&&i.a.createElement(H,null,i.a.createElement(c.t,{error:!0,title:h.t("Data element category combination validation error")},n)))}),i.a.createElement("div",null,e.map(({dataElement:e,categoryOptionCombo:a})=>i.a.createElement(H,{className:Qa.a.formRow,key:e.id+(null===a||void 0===a?void 0:a.id)},i.a.createElement(Xa,{dataElement:e,categoryOptionCombo:a})))));et.defaultProps={allRequired:!1};const{Field:at}=c.u,tt=Object.values(n),nt=()=>i.a.createElement(at,{dataTest:E("forms-fielddataset"),name:ga,label:h.t("Completeness method"),component:c.x,options:tt}),{Field:lt}=c.u,rt=()=>i.a.createElement(lt,{dataTest:E("commands-fieldcommandconfirmmessage"),name:Ta,label:h.t("Confirm message"),component:c.H}),{Field:st}=c.u,ot=()=>i.a.createElement(st,{dataTest:E("forms-fieldcommanddefaultmessage"),name:Ea,label:h.t("Reply message if no codes are sent (only the command)"),component:c.H}),{Field:ct}=c.u,mt=()=>i.a.createElement(ct,{dataTest:E("forms-fieldcommandmorethanoneorgunitmessage"),name:ba,label:h.t("More than one orgunit message"),component:c.H}),{Field:it}=c.u,dt=()=>i.a.createElement(it,{required:!0,dataTest:E("commands-fieldcommandname"),name:fa,label:h.t("Name"),component:c.m,validate:Object(c.I)(c.K,c.J)}),{Field:ut}=c.u,gt=()=>i.a.createElement(ut,{dataTest:E("forms-fieldcommandnousermessage"),name:ya,label:h.t("No user message"),component:c.H}),Et={value:"KEY_VALUE_PARSER",label:h.t("Key value parser")},pt={value:"J2ME_PARSER",label:h.t("J2ME parser")},bt={value:"ALERT_PARSER",label:h.t("Alert parser")},ft={value:"UNREGISTERED_PARSER",label:h.t("Unregistered parser")},yt={value:"TRACKED_ENTITY_REGISTRATION_PARSER",label:h.t("Tracked entity registration parser")},vt={value:"PROGRAM_STAGE_DATAENTRY_PARSER",label:h.t("Program stage data entry parser")},ht={value:"EVENT_REGISTRATION_PARSER",label:h.t("Event registration parser")},{Field:St}=c.u,wt=Object.values(l).sort((e,a)=>e.label<a.label?-1:e.label>a.label?1:0),Ct=({disabled:e})=>i.a.createElement(St,{disabled:e,dataTest:E("forms-fieldcommandparser"),name:va,label:h.t("Parser"),component:c.x,options:wt});Ct.defaultProps={disabled:!1};const{Field:_t}=c.u,Ot=()=>i.a.createElement(_t,{dataTest:E("forms-fieldcommandseparator"),name:wa,label:h.t("Field separator"),component:c.m}),{Field:At,useFormState:Nt}=c.u,Tt={values:!0},Mt=({id:e,displayName:a,valueType:t})=>{const{values:n}=Nt({subscription:Tt}),l=n[Ca][e];return i.a.createElement(At,{required:!0,name:"".concat(Ca,".").concat(e),label:a,component:c.m,format:e=>(null===e||void 0===e?void 0:e.code)||"",parse:n=>l?Object(ne.a)(Object(ne.a)({},l),{},{code:n}):{code:n,trackedEntityAttribute:{id:e,displayName:a,valueType:t}}})};var kt=t(210),Rt=t.n(kt);const{Field:jt,useForm:It}=c.u,Dt=({index:e})=>{const{change:a,getState:t}=It();return i.a.createElement("div",{key:e,className:Rt.a.container},i.a.createElement(jt,{required:!0,className:Rt.a.field,dataTest:E("@TODO"),label:h.t("Special character name"),name:"".concat(_a,"[").concat(e,"].name"),component:c.m,validate:c.J}),i.a.createElement(jt,{required:!0,className:Rt.a.field,dataTest:E("@TODO"),label:h.t("Special character value"),name:"".concat(_a,"[").concat(e,"].value"),component:c.m,validate:c.J}),i.a.createElement(c.k,{label:"\xa0"},i.a.createElement(c.c,{className:Rt.a.button,onClick:()=>{const n=t().values[_a],l=[...n.slice(0,e),...n.slice(e+1)];a(_a,l)}},h.t("Remove"))))},{Field:Ft}=c.u,Pt=()=>i.a.createElement(Ft,{dataTest:E("forms-fieldcommandsuccessmessage"),name:Oa,label:h.t("Success message"),component:c.H}),{Field:xt}=c.u,Lt=()=>i.a.createElement(xt,{type:"checkbox",dataTest:E("forms-fieldusecurrentperiodforreporting"),name:Aa,label:h.t("Use current period for reporting"),component:c.h}),{Field:Gt}=c.u,qt=()=>i.a.createElement(Gt,{dataTest:E("forms-fieldcommandwrongformatmessage"),name:Na,label:h.t("Wrong format message"),component:c.H}),{Field:Ut}=c.u,Vt=({programStageDataElements:e,smsCodes:a})=>i.a.createElement(i.a.Fragment,null,e.map(({dataElement:e})=>i.a.createElement(Ut,{key:e.id,name:"".concat(Ca,".").concat(e.id),label:e.displayName,component:c.m,format:e=>(null===e||void 0===e?void 0:e.code)||null,parse:t=>{const n=a[e.id];return Object(ne.a)(Object(ne.a)({},n),{},{code:t||"",dataElement:e})}}))),Bt=(e,a)=>{const t=e.id,n=null===a||void 0===a?void 0:a.code;return!n||"default"===n?"".concat(Ca,".").concat(t):"".concat(Ca,".").concat(t,"-").concat(n)},Ht=({onCancelClick:e,onDeleteClick:a})=>i.a.createElement(c.p,{dataTest:E("commands-deleteconfirmationdialog")},i.a.createElement(c.s,null,h.t("Confirm deletion")),i.a.createElement(c.r,null,h.t("Are you sure you want to delete the selected commands?")),i.a.createElement(c.q,null,i.a.createElement(c.d,null,i.a.createElement(c.c,{secondary:!0,onClick:e,dataTest:E("commands-deleteconfirmationdialog-cancel")},h.t("Cancel")),i.a.createElement(c.c,{primary:!0,onClick:a,dataTest:E("commands-deleteconfirmationdialog-confirm")},h.t("Delete"))))),{useFormState:zt}=c.u,Jt={submitting:!0,pristine:!0},Wt=()=>{const{submitting:e,pristine:a}=zt({subscription:Jt});return i.a.createElement(c.c,{primary:!0,type:"submit",disabled:a||e,icon:e?i.a.createElement(c.i,{small:!0}):null},h.t("Save command"))},{useFormState:Kt}=c.u,Yt={submitError:!0,hasSubmitErrors:!0},Xt=()=>{const{submitError:e,hasSubmitErrors:a}=Kt({subscription:Yt});return a?i.a.createElement(H,null,i.a.createElement(c.t,{error:!0,title:h.t("Something went wrong whilst submitting the form")},e)):null},Zt=(e,a)=>e===a.value,Qt={resource:"smsCommands",type:"create",data:({parserType:e,name:a,dataset:t,userGroup:n,program:l,programStage:r})=>{if(e===Et.value||e===pt.value)return{parserType:e,name:a,dataset:t};if(e===bt.value||e===ft.value)return{parserType:e,name:a,userGroup:{id:n}};if(e===yt.value||e===ht.value)return{parserType:e,name:a,program:l};if(e===vt.value)return{parserType:e,name:a,program:l,programStage:r};throw new Error('You provided an unrecognized parserType "'.concat(e,'"'))}},$t={resource:"smsCommands",type:"delete",id:({id:e})=>e},en=()=>{const[e,a]=Object(m.useState)(!1),[t,n]=Object(m.useState)(null),l=(e=>a=>{const t={id:a};return e.mutate($t,{variables:t})})(Object(ge.c)()),r=e=>(a(!1),e),s=e=>{n(e),a(!1)};return[({ids:e})=>(a(!0),Promise.all(e.map(l)).then(r).catch(s)),{loading:e,error:t}]},an={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:"parserType",paging:"false"}}},tn={smsCommands:{resource:"smsCommands",pager:!1,params:({ids:e}={})=>({paging:"false",fields:"*",filter:e?"ids:in:[".concat(e.join(","),"]"):void 0})}},{FORM_ERROR:nn}=c.l,ln=e=>e,rn={resource:"smsCommands",type:"update",id:({commandId:e})=>e,data:e=>{let{commandId:a}=e;return Object(Se.a)(e,["commandId"])}},sn=Object(ne.a)(Object(ne.a)({},rn),{},{partial:!0}),on=({onAfterChange:e,commandId:a,formatCommand:t=ln,replace:n=!1})=>{const{addAlert:l}=Object(m.useContext)(g),r=Object(ge.c)();return s=>{const o={variables:Object(ne.a)(Object(ne.a)({},t(s)),{},{commandId:a})},c=n?sn:rn;return r.mutate(c,o).then(e).catch(e=>{if("access"===e.type){const a="No error message was provided",t=e.message||h.t(a);return{[nn]:t}}l({type:"critical",message:e.message})})}},{Field:cn}=c.u,mn=({userGroups:e,loading:a,required:t,disabled:n,errorText:l})=>i.a.createElement(cn,{disabled:n,error:!!l,validationText:l,required:t,loading:a,dataTest:E("forms-fielduserGroup"),name:"userGroup",label:h.t("Usergroup"),component:c.x,options:e,validate:t&&c.J});mn.defaultProps={disabled:!1,loading:!1,required:!1,errorText:""};const dn={userGroups:{resource:"userGroups",params:{paging:"false"}}},un=({required:e})=>{const{loading:a,error:t,data:n}=Object(ge.e)(dn);if(a)return i.a.createElement(mn,{required:e,loading:!0,showLoadingStatus:!0,userGroups:[]});if(t)return i.a.createElement(mn,{required:e,disabled:!0,userGroups:[],errorText:t.message});const{userGroups:l}=n.userGroups,r=l.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(mn,{required:e,userGroups:r})};un.defaultProps={required:!1};const{Form:gn}=c.u,En={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","receivedMessage","userGroup[name,id]"]}}},pn=({commandId:e,onAfterChange:a})=>{const t=on({commandId:e,onAfterChange:a,replace:!0}),{loading:n,error:l,data:r}=Object(ge.e)(En,{variables:{commandId:e}});if(n)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));if(l){const e=h.t("Something went wrong whilst loading the sms command");return i.a.createElement(c.t,{error:!0,title:e},l.message)}const{name:s,parserType:o,receivedMessage:m,userGroup:d}=r.smsCommand,u={name:s,parserType:o,receivedMessage:m,userGroup:d.id},g=[{value:d.id,label:d.name}];return i.a.createElement(gn,{onSubmit:t,initialValues:u},({handleSubmit:e})=>i.a.createElement("form",{onSubmit:e,"data-test":E("commands-commandunregisteredparserform")},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(mn,{disabled:!0,userGroups:g})),i.a.createElement(H,null,i.a.createElement(rt,null)),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},{Field:bn}=c.u,fn=({programs:e,loading:a,required:t,disabled:n,errorText:l})=>i.a.createElement(bn,{error:!!l,validationText:l,disabled:n,required:t,loading:a,dataTest:E("forms-fieldprogram"),name:"program",label:h.t("Program"),component:c.x,options:e,validate:t&&c.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});fn.defaultProps={disabled:!1,errorText:"",loading:!1,required:!1};const yn={programs:{resource:"programs",params:({registration:e})=>{const a={paging:"false"};if("undefined"!==typeof e){const t=e?"programType:eq:WITH_REGISTRATION":"programType:eq:WITHOUT_REGISTRATION";a.filter=t}return a}}},vn=({required:e,registration:a})=>{const t={registration:a},{loading:n,error:l,data:r}=(e=>Object(ge.e)(yn,{variables:{registration:e}}))({variables:t});if(n)return i.a.createElement(fn,{required:e,loading:!0,showLoadingStatus:!0,programs:[]});if(l)return i.a.createElement(fn,{required:e,disabled:!0,programs:[],errorText:l.message});const{programs:s}=r.programs,o=s.map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(fn,{required:e,programs:o})};vn.defaultProps={required:!1,registration:void 0};const{Form:hn}=c.u,Sn=e=>Object(ne.a)(Object(ne.a)({},e),{},{[Ca]:Object.values(e[Ca])}),wn={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","separator","defaultMessage","wrongFormatMessage","noUserMessage","moreThanOneOrgUnitMessage","successMessage","program[id,displayName,programTrackedEntityAttributes[trackedEntityAttribute[:all,id,displayName]]]","smsCodes[:all,trackedEntityAttribute[id,displayName,valueType]]"]}}},Cn=({commandId:e,onAfterChange:a})=>{const t=on({commandId:e,onAfterChange:a,formatCommand:Sn}),{loading:n,error:l,data:r}=Object(ge.e)(wn,{variables:{commandId:e}});if(n)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));if(l){const e=h.t("Something went wrong whilst loading the sms command");return i.a.createElement(c.t,{error:!0,title:e},l.message)}const{name:s,parserType:o,program:m,separator:d,defaultMessage:u,wrongFormatMessage:g,noUserMessage:E,moreThanOneOrgUnitMessage:p,successMessage:b,smsCodes:f}=r.smsCommand,y=f.reduce((e,a)=>Object(ne.a)(Object(ne.a)({},e),{},{[a.trackedEntityAttribute.id]:a}),{}),v={name:s,parserType:o,program:m,separator:d,defaultMessage:u,wrongFormatMessage:g,noUserMessage:E,moreThanOneOrgUnitMessage:p,successMessage:b,smsCodes:y},S={value:m.id,label:m.displayName},w=m.programTrackedEntityAttributes.map(({trackedEntityAttribute:e})=>e).map(e=>{const{id:a,displayName:t,valueType:n}=e,l={id:a,displayName:t,valueType:n},r=y[a];return r&&(l.initialValue=r.code),l});return i.a.createElement(hn,{onSubmit:t,initialValues:v},({handleSubmit:e})=>i.a.createElement("form",{onSubmit:e},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(fn,{disabled:!0,programs:[S]})),i.a.createElement(H,null,i.a.createElement(Ot,null)),i.a.createElement(H,null,i.a.createElement(ot,null)),i.a.createElement(H,null,i.a.createElement(qt,null)),i.a.createElement(H,null,i.a.createElement(gt,null)),i.a.createElement(H,null,i.a.createElement(mt,null)),i.a.createElement(H,null,i.a.createElement(Pt,null)),i.a.createElement("h2",null,h.t("Tracked entity attribute")),w.map(e=>i.a.createElement(H,{key:e.id},i.a.createElement(Mt,{id:e.id,displayName:e.displayName,valueType:e.valueType}))),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},{Field:_n}=c.u,On=({programStages:e,disabled:a,loading:t,required:n,errorText:l})=>i.a.createElement(_n,{disabled:a,error:!!l,validationText:l,required:n,loading:t,dataTest:E("forms-fieldprogramStage"),name:"programStage",label:h.t("Program stage"),component:c.x,options:e,validate:n&&c.J,format:e=>(null===e||void 0===e?void 0:e.id)||null,parse:e=>({id:e})});On.defaultProps={disabled:!1,loading:!1,required:!1,errorText:""};const An={programStages:{resource:"programStages",params:({programId:e})=>({paging:"false",filter:e?"program.id:eq:".concat(e):void 0})}},Nn=({required:e,programId:a})=>{var t;const{loading:n,error:l,data:r,refetch:s}=(({programId:e,lazy:a})=>Object(ge.e)(An,{variables:{programId:e},lazy:a}))({lazy:!0});if(Object(m.useEffect)(()=>{a&&s({programId:a})},[a]),n)return i.a.createElement(On,{loading:!0,required:e,programStages:[]});if(l)return i.a.createElement(On,{disabled:!0,errorText:l.message,required:e,programStages:[]});if(!a||!r)return i.a.createElement(On,{disabled:!0,required:e,programStages:[]});const o=((null===r||void 0===r||null===(t=r.programStages)||void 0===t?void 0:t.programStages)||[]).map(({id:e,displayName:a})=>({label:a,value:e}));return i.a.createElement(On,{required:e,programStages:o})};Nn.defaultProps={required:!1};const Tn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","program[id,displayName]","programStage[id,displayName,programStageDataElements[dataElement[id,displayName]]]"],paging:"false"}}},{Form:Mn}=c.u,kn=e=>Object(ne.a)(Object(ne.a)({},e),{},{[Ca]:Object.values(e[Ca])}),Rn=({commandId:e,onAfterChange:a})=>{const{error:t,data:n}=(l=e,Object(ge.e)(Tn,{variables:{id:l}}));var l;const r=null===n||void 0===n?void 0:n.smsCommand,s=null===r||void 0===r?void 0:r.programStage.programStageDataElements,o=on({commandId:e,onAfterChange:a,formatCommand:kn});if(t){const e=h.t("Something went wrong whilst loading the command's details");return i.a.createElement(c.t,{error:!0,title:e},t.message)}if(!r)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));const m=(e=>{const a=e[fa],t=e[ha],n=e[Sa],l=e[wa],r=e[Ea],s=e[Na],o=e[ya],c=e[ba],m=e[Oa],i=e[Ca].reduce((e,a)=>Object(ne.a)(Object(ne.a)({},e),{},{[a.dataElement.id]:a}),{});return{[fa]:a,[va]:vt.value,[ha]:t,[Sa]:n,[wa]:l,[Ea]:r,[Na]:s,[ya]:o,[ba]:c,[Oa]:m,[Ca]:i}})(r),d={value:r.program.id,label:r.program.displayName},u={value:r.programStage.id,label:r.programStage.displayName};return i.a.createElement(Mn,{onSubmit:o,initialValues:m},({handleSubmit:e,values:a})=>i.a.createElement("form",{onSubmit:e,"data-test":E("commands-commandeditprogramstagedataentryparserform")},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(fn,{disabled:!0,programs:[d]})),i.a.createElement(H,null,i.a.createElement(On,{disabled:!0,programStages:[u]})),i.a.createElement(H,null,i.a.createElement(Ot,null)),i.a.createElement(H,null,i.a.createElement(ot,null)),i.a.createElement(H,null,i.a.createElement(qt,null)),i.a.createElement(H,null,i.a.createElement(gt,null)),i.a.createElement(H,null,i.a.createElement(mt,null)),i.a.createElement(H,null,i.a.createElement(Pt,null)),s&&i.a.createElement(H,null,i.a.createElement("h2",null,h.t("Program stage data elements")),i.a.createElement(Vt,{programStageDataElements:s,smsCodes:a[Ca]})),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},jn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","dataset[id,displayName,dataSetElements[dataElement[id,displayName,categoryCombo[categoryOptionCombos[id,displayName,code]]]]"],paging:"false"}}},{Form:In,FormSpy:Dn}=c.u,Fn=e=>a=>{let t=!1;const n={},l=a[ga],r=a[Ca],s=(r?Object.entries(r):[]).filter(([e,{code:a}])=>a);if(l===Ra.value&&s.length!==(null===e||void 0===e?void 0:e.length)?(t=!0,n[Ca]=n[Ca]||{},n[Ca]={global:h.t('With completeness method "'.concat(Ra.label,'", all sms codes need to have a value'))}):l!==ja.value||s.length||(t=!0,n[Ca]=n[Ca]||{},Object.assign(n[Ca],{global:h.t('With completeness method "'.concat(ja.label,'", you need to provide at least one value'))})),s.length){const e=(e=>e.reduce((a,t,n)=>{const[l,r]=t;if(a.includes(l))return a;const s=e.filter(([e,a],t)=>a.code===r.code&&t!==n);if(!s.length)return a;const o=s.reduce((e,[a])=>[...e,a],[l]);return[...a,...o]},[]))(s);if(e.length){t=!0;const a={};e.forEach(e=>{a[e]={code:h.t("Duplicate value!")}}),n[Ca]=n[Ca]||{},Object.assign(n[Ca],a)}}return t?n:void 0},Pn=e=>{const a=e[Ca],t=Object.entries(a).map(([e,{code:a,formula:t,compulsory:n,optionId:l}])=>{const[r]=e.split("-"),s={code:a,compulsory:n,dataElement:{id:r}};return t&&(s.formula=t),l&&(s.optionId=l),s});return Object(ne.a)(Object(ne.a)({},e),{},{[Ca]:t})},xn=({commandId:e,onAfterChange:a,dataTest:t,initialCompletenessMethod:n})=>{const{error:l,data:r}=(s=e,Object(ge.e)(jn,{variables:{id:s}}));var s;const o=null===r||void 0===r?void 0:r.smsCommand,m=on({commandId:e,onAfterChange:a,formatCommand:Pn});if(l){const e=h.t("Something went wrong whilst loading the command's details");return i.a.createElement(c.t,{error:!0,title:e},l.message)}if(!o)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));const d={value:o.dataset.id,label:o.dataset.displayName},u=((e,a)=>{const t=e[fa],n=Et.value,l={id:e.dataset.id},r=e[wa],s=a||e[ga]||Ra.value,o=e[Aa],c=e[Ea],m=e[Na],i=e[ya],d=e[ba],u=e[Oa],g=e[Ca].reduce((e,{code:a,compulsory:t,formula:n,optionId:l,dataElement:r})=>{const s=l<10?r.id:"".concat(r.id,"-").concat(l),o={code:a,compulsory:t,optionId:l};return n&&(o.formula=n),Object(ne.a)(Object(ne.a)({},e),{},{[s]:o})},{}),E=e[_a]||[];return{[fa]:t,[va]:n,dataset:l,[wa]:r,[ga]:s,[Aa]:o,[Ea]:c,[Na]:m,[ya]:i,[ba]:d,[Oa]:u,smsCodes:g,specialCharacters:E}})(o,n),g=o.dataset.dataSetElements.reduce((e,{dataElement:a})=>{var t;const n=null===(t=a.categoryCombo)||void 0===t?void 0:t.categoryOptionCombo;if(!n)return[...e,{dataElement:a}];const l=n.map(e=>({dataElement:a,categoryOptionCombo:e}));return[...e,...l]},[]);return i.a.createElement(In,{onSubmit:m,initialValues:u,validate:Fn(g),subscription:{}},({handleSubmit:e,form:a})=>i.a.createElement("form",{onSubmit:e,"data-test":t},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(Fa,{disabled:!0,dataSets:[d]})),i.a.createElement(H,null,i.a.createElement(nt,null)),i.a.createElement(H,null,i.a.createElement(Lt,null)),i.a.createElement(H,null,i.a.createElement(Ot,null)),i.a.createElement(H,null,i.a.createElement(ot,null)),i.a.createElement(H,null,i.a.createElement(qt,null)),i.a.createElement(H,null,i.a.createElement(gt,null)),i.a.createElement(H,null,i.a.createElement(mt,null)),i.a.createElement(H,null,i.a.createElement(Pt,null)),g&&i.a.createElement(et,{DE_COC_combinations:g}),i.a.createElement("div",null,i.a.createElement("h2",null,"Special characters"),i.a.createElement(Dn,{subscription:{values:!0}},({values:e})=>i.a.createElement(i.a.Fragment,null,e[_a].map((e,a)=>i.a.createElement(H,{key:a},i.a.createElement(Dt,{index:a}))))),i.a.createElement(ka,null),i.a.createElement(H,null,i.a.createElement("hr",null))),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},Ln=({commandId:e,onAfterChange:a})=>i.a.createElement(xn,{dataTest:E("smscommandkeyvalueparser-commandeditkeyvalueparserform"),commandId:e,onAfterChange:a}),Gn=({commandId:e,onAfterChange:a})=>i.a.createElement(xn,{dataTest:E("smscommandkeyvalueparser-commandeditj2meparserform"),commandId:e,onAfterChange:a,initialCompletenessMethod:ja.value}),qn={smsCommand:{resource:"smsCommands",id:({id:e})=>e,params:{fields:["*","program[id,displayName]","programStage[id,displayName,programStageDataElements[id,dataElement[id,displayName]]"],paging:"false"}}},{Form:Un}=c.u,Vn=e=>Object(ne.a)(Object(ne.a)({},e),{},{[Ca]:Object.values(e[Ca])}),Bn=({commandId:e,onAfterChange:a})=>{const{error:t,data:{smsCommand:n}={}}=(l=e,Object(ge.e)(qn,{variables:{id:l}}));var l;const r=on({commandId:e,onAfterChange:a,formatCommand:Vn});if(t){const e=h.t("Something went wrong whilst loading the command's details");return i.a.createElement(c.t,{error:!0,title:e},t.message)}if(!n)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));const s={value:n.program.id,label:n.program.displayName},o={value:n.programStage.id,label:n.programStage.displayName},m=n.programStage.programStageDataElements,d=(e=>{const a=e[fa],t=e[ha],n=e[Sa],l=e[wa],r=e[Ea],s=e[Na],o=e[ya],c=e[ba],m=e[Oa],i=e[Ca].reduce((e,a)=>Object(ne.a)(Object(ne.a)({},e),{},{[a.dataElement.id]:a}),{});return{[fa]:a,[va]:ht.value,[ha]:t,[Sa]:n,[wa]:l,[Ea]:r,[Na]:s,[ya]:o,[ba]:c,[Oa]:m,[Ca]:i}})(n);return i.a.createElement(Un,{initialValues:d,onSubmit:r},({handleSubmit:e,values:a})=>i.a.createElement("form",{onSubmit:e},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(fn,{disabled:!0,programs:[s]})),i.a.createElement(H,null,i.a.createElement(On,{disabled:!0,programStages:[o]})),i.a.createElement(H,null,i.a.createElement(Ot,null)),i.a.createElement(H,null,i.a.createElement(ot,null)),i.a.createElement(H,null,i.a.createElement(qt,null)),i.a.createElement(H,null,i.a.createElement(gt,null)),i.a.createElement(H,null,i.a.createElement(mt,null)),i.a.createElement(H,null,i.a.createElement(Pt,null)),m&&i.a.createElement(H,null,i.a.createElement("h2",null,h.t("Program stage data elements")),i.a.createElement(Vt,{programStageDataElements:m,smsCodes:a[Ca]})),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},{Form:Hn}=c.u,zn={smsCommand:{resource:"smsCommands",id:({commandId:e})=>e,params:{fields:["name","parserType","receivedMessage","userGroup[name,id]"]}}},Jn=({commandId:e,onAfterChange:a})=>{const t=on({commandId:e,onAfterChange:a,replace:!0}),{loading:n,error:l,data:r}=Object(ge.e)(zn,{variables:{commandId:e}});if(n)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));if(l){const e=h.t("Something went wrong whilst loading the sms command");return i.a.createElement(c.t,{error:!0,title:e},l.message)}const{name:s,parserType:o,receivedMessage:m,userGroup:d}=r.smsCommand,u={name:s,parserType:o,receivedMessage:m,userGroup:d.id},g=[{value:d.id,label:d.name}];return i.a.createElement(Hn,{onSubmit:t,initialValues:u},({handleSubmit:e})=>i.a.createElement("form",{onSubmit:e,"data-test":E("commands-commandeditalertparserform")},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,{disabled:!0})),i.a.createElement(H,null,i.a.createElement(mn,{disabled:!0,userGroups:g})),i.a.createElement(H,null,i.a.createElement(rt,null)),i.a.createElement(Xt,null),i.a.createElement(Wt,null)))},Wn="".concat("/sms-config/edit","/:id"),Kn=()=>{const e=Object(o.f)(),{id:a}=Object(o.h)(),{loading:t,error:n,data:l}=(e=>Object(ge.e)(an,{variables:{id:e}}))(a);if(t)return i.a.createElement(c.f,null,i.a.createElement(c.i,null));if(n){const e=h.t("Something went wrong whilst loading commands");return i.a.createElement(c.t,{error:!0,title:e},n.message)}const r=null===l||void 0===l?void 0:l.smsCommand[va],s=Zt.bind(null,r);return i.a.createElement("div",null,i.a.createElement(C,null,h.t("Edit command")),r&&s(Et)&&i.a.createElement(Ln,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(pt)&&i.a.createElement(Gn,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(bt)&&i.a.createElement(Jn,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(vt)&&i.a.createElement(Rn,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(ft)&&i.a.createElement(pn,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(ht)&&i.a.createElement(Bn,{commandId:a,onAfterChange:()=>e.push(tl)}),r&&s(yt)&&i.a.createElement(Cn,{commandId:a,onAfterChange:()=>e.push(tl)}),!r&&i.a.createElement(c.t,{error:!0,title:h.t("Unrecognised parser type")},h.t("Could not find the requested parser type")))},{Form:Yn,useForm:Xn}=c.u,Zn=({handleSubmit:e,submitting:a})=>{(()=>{const e=Xn(),[a,t]=Object(m.useState)(e.getState().values);Object(m.useEffect)(()=>e.subscribe(({values:n})=>{e.batch(()=>{const t=n[va],l=n.program,r=n.programStage,s=a.program,o=a[va];r&&(s&&l!==s||o&&t!==o)&&e.change("programStage",null)}),t(n)},{values:!0}),[a])})();const t=Xn(),{values:n}=t.getState(),l=n[va],r=n.program,s=l===Et.value||l===pt.value,o=l===bt.value||l===ft.value,d=l===yt.value||l===vt.value||l===ht.value,u=l===vt.value,g=l!==ht.value&&void 0;return i.a.createElement("div",null,i.a.createElement(C,null,h.t("Add command")),i.a.createElement("form",{onSubmit:e},i.a.createElement(H,null,i.a.createElement(dt,null)),i.a.createElement(H,null,i.a.createElement(Ct,null)),s&&i.a.createElement(H,null,i.a.createElement(xa,null)),o&&i.a.createElement(H,null,i.a.createElement(un,null)),d&&i.a.createElement(H,null,i.a.createElement(vn,{registration:g})),u&&i.a.createElement(H,null,i.a.createElement(Nn,{programId:r||""})),i.a.createElement(c.c,{primary:!0,type:"submit",icon:a?i.a.createElement(c.i,{small:!0}):null,disabled:a},h.t("Add command"))))},Qn=()=>{const e=Object(o.f)(),[a]=(({onComplete:e,onError:a})=>Object(ge.d)(Qt,{onComplete:e,onError:a}))({onComplete:()=>e.push(tl)});return i.a.createElement(Yn,{onSubmit:e=>a(e)},({handleSubmit:e,submitting:a})=>i.a.createElement(Zn,{handleSubmit:e,submitting:a}))};var $n=t(211),el=t.n($n);const al=h.t("Commands"),tl="/sms-config",nl=()=>{var e,a,t,n,l,s;const d=Object(o.f)(),[u,g]=Object(m.useState)([]),[p,b]=Object(m.useState)(!1),{loading:f,error:y,data:v,refetch:S}=Object(ge.e)(tn),[w,{loading:_,error:O}]=en();if(f)return i.a.createElement("div",{"data-test":E("views-smscommandlist")},i.a.createElement(C,null,al),i.a.createElement(c.f,null,i.a.createElement(c.i,null)));const A=y||O;if(A){const e=h.t("Something went wrong whilst performing the requested operation");return i.a.createElement("div",{"data-test":E("views-smscommandlist")},i.a.createElement(C,null,al),i.a.createElement(c.t,{error:!0,title:e},A.message))}const N=u.length===(null===v||void 0===v||null===(e=v.smsCommands)||void 0===e||null===(a=e.smsCommands)||void 0===a?void 0:a.length),T=(null===v||void 0===v||null===(t=v.smsCommands)||void 0===t||null===(n=t.smsCommands)||void 0===n?void 0:n.length)>0;return i.a.createElement("div",{"data-test":E("views-smscommandlist")},i.a.createElement(C,null,al),i.a.createElement(De,{addLabel:h.t("Add command"),deleteLabel:h.t("Delete selected"),dataTest:"views-smscommandlist",onAddClick:()=>d.push("/sms-config/new"),onDeleteClick:()=>b(!0),disableAdd:_,disableDelete:!u.length||_}),p&&i.a.createElement(Ht,{onCancelClick:()=>b(!1),onDeleteClick:async()=>{const e=u.map(({id:e})=>e);await w({ids:e}),g([]),b(!1),S()}}),i.a.createElement(c.z,null,i.a.createElement(c.E,null,i.a.createElement(c.G,null,i.a.createElement(c.C,null,i.a.createElement(c.g,{checked:N,onChange:()=>{var e;const a=null===v||void 0===v||null===(e=v.smsCommands)||void 0===e?void 0:e.smsCommands;a&&(u.length===a.length?g([]):g(a.map(({id:e,displayName:a})=>({id:e,displayName:a}))))}})),i.a.createElement(c.C,null,h.t("Sms command")),i.a.createElement(c.C,null,h.t("Parser")),i.a.createElement(c.C,null))),i.a.createElement(c.A,null,T?null===v||void 0===v||null===(l=v.smsCommands)||void 0===l||null===(s=l.smsCommands)||void 0===s?void 0:s.map(({id:e,displayName:a,parserType:t})=>i.a.createElement(c.F,{key:e},i.a.createElement(c.B,{className:el.a.checkbox},i.a.createElement(c.g,{checked:!!u.find(({id:a})=>e===a),onChange:()=>(e=>{const{id:a}=e;if(u.find(({id:e})=>a===e)){const e=u.findIndex(({id:e})=>a===e);return g([...u.slice(0,e),...u.slice(e+1)])}return g([...u,e])})({id:e,displayName:a})})),i.a.createElement(c.B,null,a),i.a.createElement(c.B,null,(e=>{const a=Object.values(r).find(({value:a})=>a===e);return(null===a||void 0===a?void 0:a.label)||e})(t)),i.a.createElement(c.B,{className:el.a.editButtonCell},i.a.createElement(c.c,{onClick:()=>d.push("".concat("/sms-config/edit","/").concat(e))},h.t("Edit"))))):i.a.createElement(c.F,null,i.a.createElement(c.B,{colSpan:"4",className:el.a.noResults},h.t("No commands to display"))))))},ll={DELIVERED:y.a.t("Delivered"),ERROR:y.a.t("Error"),FAILED:y.a.t("Failed"),OUTBOUND:y.a.t("Outbound"),PENDING:y.a.t("Pending"),SCHEDULED:y.a.t("Scheduled"),SENT:y.a.t("Sent")},rl=()=>{throw new Error("RefetchSms consumer needs to have a valid Provider as parent")};var sl=Object(m.createContext)({refetch:rl,refetchAndClear:rl});const ol={resource:"sms/outbound",params:({ids:e})=>({ids:e}),type:"delete"};var cl=({id:e,cleanSelected:a})=>{const{addAlert:t}=Object(m.useContext)(g),{refetch:n}=Object(m.useContext)(sl),[l,{loading:r}]=Object(ge.d)(ol,{onComplete:()=>{a(e),n()},onError:e=>{t({type:"critical",message:e.message})},variables:{ids:e}});return i.a.createElement(c.c,{small:!0,destructive:!0,onClick:l,disabled:r},h.t("Delete"))};var ml=({sms:e,toggleSelected:a,isSelected:t,cleanSelected:n})=>{const{message:l,status:r,date:s,id:o}=e,m=null===e.recipients?[]:e.recipients;return i.a.createElement(c.F,null,i.a.createElement(c.B,null,i.a.createElement(c.g,{onChange:()=>a(o),checked:t})),i.a.createElement(c.B,null,l),i.a.createElement(c.B,null,m.join(", ")),i.a.createElement(c.B,null,ll[r]),i.a.createElement(c.B,null,$e()(s).format("MMMM Do YYYY, h:mm:ss a")),i.a.createElement(c.B,null,i.a.createElement(cl,{id:o,cleanSelected:n})))},il=t(212),dl=t.n(il);const ul=["10","20","30","40","50","100"];var gl=({pager:e})=>{const{refetchAndClear:a}=Object(m.useContext)(sl),t=e=>{a({page:e})},{page:n,pageCount:l,pageSize:r,total:s}=e,o=Math.min((n-1)*r+1,s),d=Math.min(o+r-1,s),u=Array.from({length:l},(e,a)=>(a+1).toString());return i.a.createElement("div",{className:dl.a.container},i.a.createElement("div",{className:dl.a.left},i.a.createElement("span",null,h.t("Show")),i.a.createElement(c.v,{dense:!0,selected:r.toString(),onChange:({selected:e})=>{a({pageSize:e,page:1})}},ul.map(e=>i.a.createElement(c.y,{key:e,value:e,label:e}))),i.a.createElement("span",null,h.t("per page"))),i.a.createElement("div",{className:dl.a.right},i.a.createElement("div",{className:dl.a.amount},h.t("Viewing {{firstItem}}-{{lastItem}} of {{total}}",{firstItem:o,lastItem:d,total:s})),i.a.createElement(c.c,{small:!0,disabled:1===n,onClick:()=>t(n-1)},h.t("Previous")),i.a.createElement("div",{className:dl.a.pageselection},i.a.createElement("div",null,h.t("Page")),i.a.createElement(c.v,{dense:!0,selected:n.toString(),onChange:({selected:e})=>{t(e)}},u.map(e=>i.a.createElement(c.y,{key:e,value:e,label:e}))),i.a.createElement("div",null,h.t("of {{pageCount}}",{pageCount:l}))),i.a.createElement(c.c,{small:!0,disabled:n===l,onClick:()=>t(n+1)},h.t("Next"))))},El=t(213),pl=t.n(El);var bl=({smses:e,cleanSelected:a,toggleSelected:t,toggleAll:n,allSelected:l,selected:r,pager:s})=>i.a.createElement(c.z,null,i.a.createElement(c.E,null,i.a.createElement(c.G,null,i.a.createElement(c.C,null,i.a.createElement(c.g,{disabled:0===e.length,onChange:n,checked:l})),i.a.createElement(c.C,null,h.t("Message")),i.a.createElement(c.C,null,h.t("Recipients")),i.a.createElement(c.C,null,h.t("Status")),i.a.createElement(c.C,null,h.t("Date")),i.a.createElement(c.C,null,h.t("Delete")))),i.a.createElement(c.A,null,0===e.length?i.a.createElement(c.F,null,i.a.createElement(c.B,{colSpan:"7",className:pl.a.noResults},h.t("No SMSes to display"))):e.map(e=>i.a.createElement(ml,{key:e.id,sms:e,isSelected:r.includes(e.id),toggleSelected:t,cleanSelected:a}))),i.a.createElement(c.D,null,i.a.createElement(c.F,null,i.a.createElement(c.B,{colSpan:"7"},i.a.createElement(gl,{pager:s})))));const fl=e=>"ALL"===e?"":e,yl=[{label:h.t("All"),value:"ALL"},...["DELIVERED","ERROR","FAILED","OUTBOUND","PENDING","SCHEDULED","SENT"].map(e=>({label:ll[e],value:e}))];var vl=({status:e,setStatus:a})=>{const{refetchAndClear:t}=Object(m.useContext)(sl);return i.a.createElement(c.w,{label:h.t("Filter by status"),inputWidth:"200px",onChange:({selected:e})=>{a(e),t({status:fl(e),page:1})},selected:e},yl.map(({label:e,value:a})=>i.a.createElement(c.y,{key:e,label:e,value:a})))};const hl={resource:"sms/outbound",params:({ids:e})=>({ids:e}),type:"delete"};var Sl=({selected:e})=>{const a=0===e.length,t=e.join(","),{addAlert:n}=Object(m.useContext)(g),{refetchAndClear:l}=Object(m.useContext)(sl),[r,{loading:s}]=Object(ge.d)(hl,{onComplete:()=>{l()},onError:e=>{n({type:"critical",message:e.message})}});return i.a.createElement(c.c,{destructive:!0,disabled:a||s,onClick:()=>r({ids:t})},h.t("Delete selected"))},wl=t(214),Cl=t.n(wl);const _l=h.t("Sent"),Ol="/sent",Al={sms:{resource:"sms/outbound",params:({status:e,page:a,pageSize:t})=>{const n={pageSize:t,page:a,fields:["id","message","status","date","recipients"]};return e?Object(ne.a)(Object(ne.a)({},n),{},{filter:"status:eq:".concat(e)}):n}}},Nl=()=>{var e;const[a,t]=Object(m.useState)([]),[n,l]=Object(m.useState)("ALL"),{loading:r,error:s,data:o,refetch:d}=Object(ge.e)(Al,{variables:{status:fl(n),pageSize:10,page:1}});if(r)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,_l),i.a.createElement(c.f,null,i.a.createElement(c.i,null)));if(s){const e=h.t("Something went wrong whilst loading sent SMSes");return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null,_l),i.a.createElement(c.t,{error:!0,title:e},s.message))}const u=(e=>e.map(e=>e.id))(o.sms.outboundsmss),g=((e,a)=>{const t=0===e.length,n=e.length!==a.length;return!t&&!n&&e.every(e=>a.includes(e))})(u,a),E=(({selected:e,setSelected:a})=>t=>{if(e.includes(t)){const n=e.filter(e=>e!=t);a(n)}})({selected:a,setSelected:t}),p=(({allSelected:e,setSelected:a,allIds:t})=>()=>a(e?[]:t))({allSelected:g,setSelected:t,allIds:u}),b=(({selected:e,setSelected:a})=>t=>{if(e.includes(t)){const n=e.filter(e=>e!==t);return a(n)}return a([...e,t])})({selected:a,setSelected:t}),f={refetch:d,refetchAndClear:e=>{t([]),d(e)}},y=(null===o||void 0===o||null===(e=o.sms)||void 0===e?void 0:e.outboundsmss)||[];return i.a.createElement(sl.Provider,{value:f},i.a.createElement(C,null,_l),i.a.createElement("div",{className:Cl.a.header},i.a.createElement(vl,{status:n,setStatus:l}),i.a.createElement("div",{className:Cl.a.headerRight},i.a.createElement(Sl,{selected:a}))),i.a.createElement(bl,{smses:y,cleanSelected:E,allSelected:g,selected:a,toggleSelected:b,toggleAll:p,pager:o.sms.pager}))},Tl=({label:e,path:a,exactMatch:t})=>{const n=Object(o.f)(),l=((e,a)=>{const t=Object(o.i)(e);return!!t&&(!a||t.isExact)})(a,t);return i.a.createElement(c.o,{onClick:()=>n.push(a),active:l,label:e,dataTest:E("navigation-navigationitem")})};Tl.defualtProps={exactMatch:!1};const Ml=()=>i.a.createElement(c.n,{dataTest:E("navigation-navigation")},i.a.createElement(Tl,{path:"/",label:"Overview",exactMatch:!0}),i.a.createElement(Tl,{path:xe,label:"Gateway configuration"}),i.a.createElement(Tl,{path:tl,label:al}),i.a.createElement(Tl,{path:Ol,label:_l}),i.a.createElement(Tl,{path:Ue,label:qe}));a.default=()=>i.a.createElement(p,null,i.a.createElement(c.j,{spacers:!0,colors:!0}),i.a.createElement(s.a,null,i.a.createElement("div",{className:u.a.container,"data-test":E("app")},i.a.createElement("div",{className:u.a.sidebar},i.a.createElement(Ml,null)),i.a.createElement("main",{className:u.a.content},i.a.createElement(o.c,null,i.a.createElement(o.a,{exact:!0,path:"/",component:A}),"",i.a.createElement(o.a,{exact:!0,path:xe,component:Le}),i.a.createElement(o.a,{exact:!0,path:le,component:re}),i.a.createElement(o.a,{exact:!0,path:"/sms-gateway/new",component:Re}),"",i.a.createElement(o.a,{exact:!0,path:tl,component:nl}),i.a.createElement(o.a,{exact:!0,path:Wn,component:Kn}),i.a.createElement(o.a,{exact:!0,path:"/sms-config/new",component:Qn}),"",i.a.createElement(o.a,{exact:!0,path:Ol,component:Nl}),"",i.a.createElement(o.a,{exact:!0,path:Ue,component:ua}),i.a.createElement(o.a,{component:b}))))))}}]);
//# sourceMappingURL=app.45f6fd8c.chunk.js.map